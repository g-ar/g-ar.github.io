<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article# " lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="Some random stuffs -- Programming and Mathematics">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Gopinath A R (old posts, page 1) | Gopinath A R</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta content="#5670d4" name="theme-color">
<link rel="alternate" type="application/rss+xml" title="RSS" href="rss.xml">
<link rel="canonical" href="https://g-ar.github.io/index-1.html">
<link rel="prev" href="index-2.html" type="text/html">
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"] ],
        displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
        processEscapes: true
    },
    displayAlign: 'left', // Change this to 'center' to center equations.
    "HTML-CSS": {
        styles: {'.MathJax_Display': {"margin": 0}}
    }
});
</script><!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]-->
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://g-ar.github.io/">

                <span id="blog-title">Gopinath A R</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="archive.html">Archive</a>
                </li>
<li>
<a href="categories/">Tags</a>
                </li>
<li>
<a href="rss.xml">RSS feed</a>
                </li>
<li>
<a href="stories/about-me/">About</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            

    
<div class="postindex">
    <article class="h-entry post-text"><header><h1 class="p-name entry-title"><a href="posts/generating-image-patterns/" class="u-url">Generating image patterns</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn">
                Gopinath
            </span></p>
            <p class="dateline"><a href="posts/generating-image-patterns/" rel="bookmark"><time class="published dt-published" datetime="2014-02-07T20:11:32+05:30" title="2014-02-07 20:11">2014-02-07 20:11</time></a></p>
        </div>
    </header><div class="e-content entry-content">
    <div>
<p>Computer and art mix very nicely. We can algorithmically generate patterns, be it pictures or music, which are aesthetic.</p>
<p>Here is an example program for *nix systems which generates fractal like tiling.
We use tga format, which is simple but uncompressed. For compression, we may use imagemagick suit's convert command.</p>
<table class="codetable"><tr>
<td class="linenos"><div class="linenodiv"><pre><a href="posts/generating-image-patterns/#rest_code_3bd83ce7e61b4f9e87020e9798d0d9c7-0"> 0</a>
<a href="posts/generating-image-patterns/#rest_code_3bd83ce7e61b4f9e87020e9798d0d9c7-1"> 1</a>
<a href="posts/generating-image-patterns/#rest_code_3bd83ce7e61b4f9e87020e9798d0d9c7-2"> 2</a>
<a href="posts/generating-image-patterns/#rest_code_3bd83ce7e61b4f9e87020e9798d0d9c7-3"> 3</a>
<a href="posts/generating-image-patterns/#rest_code_3bd83ce7e61b4f9e87020e9798d0d9c7-4"> 4</a>
<a href="posts/generating-image-patterns/#rest_code_3bd83ce7e61b4f9e87020e9798d0d9c7-5"> 5</a>
<a href="posts/generating-image-patterns/#rest_code_3bd83ce7e61b4f9e87020e9798d0d9c7-6"> 6</a>
<a href="posts/generating-image-patterns/#rest_code_3bd83ce7e61b4f9e87020e9798d0d9c7-7"> 7</a>
<a href="posts/generating-image-patterns/#rest_code_3bd83ce7e61b4f9e87020e9798d0d9c7-8"> 8</a>
<a href="posts/generating-image-patterns/#rest_code_3bd83ce7e61b4f9e87020e9798d0d9c7-9"> 9</a>
<a href="posts/generating-image-patterns/#rest_code_3bd83ce7e61b4f9e87020e9798d0d9c7-10">10</a>
<a href="posts/generating-image-patterns/#rest_code_3bd83ce7e61b4f9e87020e9798d0d9c7-11">11</a>
<a href="posts/generating-image-patterns/#rest_code_3bd83ce7e61b4f9e87020e9798d0d9c7-12">12</a>
<a href="posts/generating-image-patterns/#rest_code_3bd83ce7e61b4f9e87020e9798d0d9c7-13">13</a>
<a href="posts/generating-image-patterns/#rest_code_3bd83ce7e61b4f9e87020e9798d0d9c7-14">14</a>
<a href="posts/generating-image-patterns/#rest_code_3bd83ce7e61b4f9e87020e9798d0d9c7-15">15</a>
<a href="posts/generating-image-patterns/#rest_code_3bd83ce7e61b4f9e87020e9798d0d9c7-16">16</a>
<a href="posts/generating-image-patterns/#rest_code_3bd83ce7e61b4f9e87020e9798d0d9c7-17">17</a>
<a href="posts/generating-image-patterns/#rest_code_3bd83ce7e61b4f9e87020e9798d0d9c7-18">18</a>
<a href="posts/generating-image-patterns/#rest_code_3bd83ce7e61b4f9e87020e9798d0d9c7-19">19</a>
<a href="posts/generating-image-patterns/#rest_code_3bd83ce7e61b4f9e87020e9798d0d9c7-20">20</a>
<a href="posts/generating-image-patterns/#rest_code_3bd83ce7e61b4f9e87020e9798d0d9c7-21">21</a>
<a href="posts/generating-image-patterns/#rest_code_3bd83ce7e61b4f9e87020e9798d0d9c7-22">22</a>
<a href="posts/generating-image-patterns/#rest_code_3bd83ce7e61b4f9e87020e9798d0d9c7-23">23</a>
<a href="posts/generating-image-patterns/#rest_code_3bd83ce7e61b4f9e87020e9798d0d9c7-24">24</a>
<a href="posts/generating-image-patterns/#rest_code_3bd83ce7e61b4f9e87020e9798d0d9c7-25">25</a>
<a href="posts/generating-image-patterns/#rest_code_3bd83ce7e61b4f9e87020e9798d0d9c7-26">26</a>
<a href="posts/generating-image-patterns/#rest_code_3bd83ce7e61b4f9e87020e9798d0d9c7-27">27</a>
<a href="posts/generating-image-patterns/#rest_code_3bd83ce7e61b4f9e87020e9798d0d9c7-28">28</a>
<a href="posts/generating-image-patterns/#rest_code_3bd83ce7e61b4f9e87020e9798d0d9c7-29">29</a>
<a href="posts/generating-image-patterns/#rest_code_3bd83ce7e61b4f9e87020e9798d0d9c7-30">30</a>
<a href="posts/generating-image-patterns/#rest_code_3bd83ce7e61b4f9e87020e9798d0d9c7-31">31</a>
<a href="posts/generating-image-patterns/#rest_code_3bd83ce7e61b4f9e87020e9798d0d9c7-32">32</a>
<a href="posts/generating-image-patterns/#rest_code_3bd83ce7e61b4f9e87020e9798d0d9c7-33">33</a>
<a href="posts/generating-image-patterns/#rest_code_3bd83ce7e61b4f9e87020e9798d0d9c7-34">34</a>
<a href="posts/generating-image-patterns/#rest_code_3bd83ce7e61b4f9e87020e9798d0d9c7-35">35</a>
<a href="posts/generating-image-patterns/#rest_code_3bd83ce7e61b4f9e87020e9798d0d9c7-36">36</a>
<a href="posts/generating-image-patterns/#rest_code_3bd83ce7e61b4f9e87020e9798d0d9c7-37">37</a>
<a href="posts/generating-image-patterns/#rest_code_3bd83ce7e61b4f9e87020e9798d0d9c7-38">38</a>
<a href="posts/generating-image-patterns/#rest_code_3bd83ce7e61b4f9e87020e9798d0d9c7-39">39</a>
<a href="posts/generating-image-patterns/#rest_code_3bd83ce7e61b4f9e87020e9798d0d9c7-40">40</a>
<a href="posts/generating-image-patterns/#rest_code_3bd83ce7e61b4f9e87020e9798d0d9c7-41">41</a>
<a href="posts/generating-image-patterns/#rest_code_3bd83ce7e61b4f9e87020e9798d0d9c7-42">42</a>
<a href="posts/generating-image-patterns/#rest_code_3bd83ce7e61b4f9e87020e9798d0d9c7-43">43</a>
<a href="posts/generating-image-patterns/#rest_code_3bd83ce7e61b4f9e87020e9798d0d9c7-44">44</a>
<a href="posts/generating-image-patterns/#rest_code_3bd83ce7e61b4f9e87020e9798d0d9c7-45">45</a></pre></div></td>
<td class="code"><pre class="code C"><a name="rest_code_3bd83ce7e61b4f9e87020e9798d0d9c7-0"></a><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp"></span>
<a name="rest_code_3bd83ce7e61b4f9e87020e9798d0d9c7-1"></a><span class="cp">#include</span> <span class="cpf">&lt;fcntl.h&gt;</span><span class="cp"></span>
<a name="rest_code_3bd83ce7e61b4f9e87020e9798d0d9c7-2"></a><span class="cp">#include</span> <span class="cpf">&lt;math.h&gt;</span><span class="cp"></span>
<a name="rest_code_3bd83ce7e61b4f9e87020e9798d0d9c7-3"></a><span class="cp">#include</span> <span class="cpf">&lt;stdlib.h&gt;</span><span class="cp"></span>
<a name="rest_code_3bd83ce7e61b4f9e87020e9798d0d9c7-4"></a><span class="cp">#include</span> <span class="cpf">&lt;unistd.h&gt;</span><span class="cp"></span>
<a name="rest_code_3bd83ce7e61b4f9e87020e9798d0d9c7-5"></a>
<a name="rest_code_3bd83ce7e61b4f9e87020e9798d0d9c7-6"></a><span class="cp">#define width 1366</span>
<a name="rest_code_3bd83ce7e61b4f9e87020e9798d0d9c7-7"></a><span class="cp">#define height 768</span>
<a name="rest_code_3bd83ce7e61b4f9e87020e9798d0d9c7-8"></a>
<a name="rest_code_3bd83ce7e61b4f9e87020e9798d0d9c7-9"></a><span class="kt">char</span> <span class="n">pic</span><span class="p">[</span><span class="n">height</span><span class="p">][</span><span class="n">width</span><span class="p">][</span><span class="mi">3</span><span class="p">];</span>
<a name="rest_code_3bd83ce7e61b4f9e87020e9798d0d9c7-10"></a>
<a name="rest_code_3bd83ce7e61b4f9e87020e9798d0d9c7-11"></a><span class="kt">int</span> <span class="nf">main</span><span class="p">(){</span>
<a name="rest_code_3bd83ce7e61b4f9e87020e9798d0d9c7-12"></a>  <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">;</span>
<a name="rest_code_3bd83ce7e61b4f9e87020e9798d0d9c7-13"></a>  <span class="kt">int</span> <span class="n">fd</span><span class="p">;</span>
<a name="rest_code_3bd83ce7e61b4f9e87020e9798d0d9c7-14"></a>  <span class="kt">char</span> <span class="n">buffer</span><span class="p">[</span><span class="mi">100</span><span class="p">];</span>
<a name="rest_code_3bd83ce7e61b4f9e87020e9798d0d9c7-15"></a>
<a name="rest_code_3bd83ce7e61b4f9e87020e9798d0d9c7-16"></a>  <span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">height</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
<a name="rest_code_3bd83ce7e61b4f9e87020e9798d0d9c7-17"></a>    <span class="k">for</span> <span class="p">(</span><span class="n">j</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">j</span><span class="o">&lt;</span><span class="n">width</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">){</span>
<a name="rest_code_3bd83ce7e61b4f9e87020e9798d0d9c7-18"></a>    <span class="n">pic</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<a name="rest_code_3bd83ce7e61b4f9e87020e9798d0d9c7-19"></a>    <span class="n">pic</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<a name="rest_code_3bd83ce7e61b4f9e87020e9798d0d9c7-20"></a>    <span class="n">pic</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">(((</span><span class="n">i</span><span class="o">^</span><span class="p">(</span><span class="o">~</span><span class="n">j</span><span class="p">))</span><span class="o">&amp;</span><span class="p">((</span><span class="o">~</span><span class="n">i</span><span class="o">-</span><span class="mi">350</span><span class="p">)</span><span class="o">&gt;&gt;</span><span class="mi">3</span><span class="p">)))</span><span class="o">&amp;</span><span class="mi">255</span><span class="p">;</span>
<a name="rest_code_3bd83ce7e61b4f9e87020e9798d0d9c7-21"></a>    <span class="p">}</span>
<a name="rest_code_3bd83ce7e61b4f9e87020e9798d0d9c7-22"></a>
<a name="rest_code_3bd83ce7e61b4f9e87020e9798d0d9c7-23"></a>  <span class="k">if</span> <span class="p">((</span><span class="n">fd</span> <span class="o">=</span> <span class="n">open</span><span class="p">(</span><span class="s">"image.tga"</span><span class="p">,</span> <span class="n">O_RDWR</span><span class="o">+</span><span class="n">O_CREAT</span><span class="p">,</span> <span class="n">S_IRUSR</span> <span class="o">|</span> <span class="n">S_IWUSR</span><span class="p">))</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a name="rest_code_3bd83ce7e61b4f9e87020e9798d0d9c7-24"></a>  <span class="p">{</span>
<a name="rest_code_3bd83ce7e61b4f9e87020e9798d0d9c7-25"></a>    <span class="n">printf</span><span class="p">(</span><span class="s">"error opening file</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
<a name="rest_code_3bd83ce7e61b4f9e87020e9798d0d9c7-26"></a>    <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<a name="rest_code_3bd83ce7e61b4f9e87020e9798d0d9c7-27"></a>  <span class="p">}</span>
<a name="rest_code_3bd83ce7e61b4f9e87020e9798d0d9c7-28"></a>  <span class="n">buffer</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<a name="rest_code_3bd83ce7e61b4f9e87020e9798d0d9c7-29"></a>  <span class="n">buffer</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<a name="rest_code_3bd83ce7e61b4f9e87020e9798d0d9c7-30"></a>  <span class="n">buffer</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
<a name="rest_code_3bd83ce7e61b4f9e87020e9798d0d9c7-31"></a>  <span class="n">buffer</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<a name="rest_code_3bd83ce7e61b4f9e87020e9798d0d9c7-32"></a>  <span class="n">buffer</span><span class="p">[</span><span class="mi">9</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<a name="rest_code_3bd83ce7e61b4f9e87020e9798d0d9c7-33"></a>  <span class="n">buffer</span><span class="p">[</span><span class="mi">10</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<a name="rest_code_3bd83ce7e61b4f9e87020e9798d0d9c7-34"></a>  <span class="n">buffer</span><span class="p">[</span><span class="mi">11</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<a name="rest_code_3bd83ce7e61b4f9e87020e9798d0d9c7-35"></a>  <span class="n">buffer</span><span class="p">[</span><span class="mi">12</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">width</span> <span class="o">&amp;</span> <span class="mh">0x00FF</span><span class="p">);</span>
<a name="rest_code_3bd83ce7e61b4f9e87020e9798d0d9c7-36"></a>  <span class="n">buffer</span><span class="p">[</span><span class="mi">13</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">width</span> <span class="o">&amp;</span> <span class="mh">0xFF00</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">;</span>
<a name="rest_code_3bd83ce7e61b4f9e87020e9798d0d9c7-37"></a>  <span class="n">buffer</span><span class="p">[</span><span class="mi">14</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">height</span> <span class="o">&amp;</span> <span class="mh">0x00FF</span><span class="p">);</span>
<a name="rest_code_3bd83ce7e61b4f9e87020e9798d0d9c7-38"></a>  <span class="n">buffer</span><span class="p">[</span><span class="mi">15</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">height</span> <span class="o">&amp;</span> <span class="mh">0xFF00</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">;</span>
<a name="rest_code_3bd83ce7e61b4f9e87020e9798d0d9c7-39"></a>  <span class="n">buffer</span><span class="p">[</span><span class="mi">16</span><span class="p">]</span> <span class="o">=</span> <span class="mi">24</span><span class="p">;</span>
<a name="rest_code_3bd83ce7e61b4f9e87020e9798d0d9c7-40"></a>  <span class="n">buffer</span><span class="p">[</span><span class="mi">17</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<a name="rest_code_3bd83ce7e61b4f9e87020e9798d0d9c7-41"></a>  <span class="n">write</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span> <span class="n">buffer</span><span class="p">,</span> <span class="mi">18</span><span class="p">);</span>
<a name="rest_code_3bd83ce7e61b4f9e87020e9798d0d9c7-42"></a>  <span class="n">write</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span> <span class="n">pic</span><span class="p">,</span> <span class="n">width</span><span class="o">*</span><span class="n">height</span><span class="o">*</span><span class="mi">3</span><span class="p">);</span>
<a name="rest_code_3bd83ce7e61b4f9e87020e9798d0d9c7-43"></a>  <span class="n">close</span><span class="p">(</span><span class="n">fd</span><span class="p">);</span>
<a name="rest_code_3bd83ce7e61b4f9e87020e9798d0d9c7-44"></a>  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<a name="rest_code_3bd83ce7e61b4f9e87020e9798d0d9c7-45"></a><span class="p">}</span>
</pre></td>
</tr></table>
<div class="figure">
<img alt="../../images/pattern.png" src="images/pattern.png"><p class="caption">Image generated by the program</p>
</div>
</div>
    </div>
    </article><article class="h-entry post-text"><header><h1 class="p-name entry-title"><a href="posts/c-code-to-assembly-using-gcc-and-gdb/" class="u-url">C code to assembly using gcc and gdb</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn">
                Gopinath
            </span></p>
            <p class="dateline"><a href="posts/c-code-to-assembly-using-gcc-and-gdb/" rel="bookmark"><time class="published dt-published" datetime="2014-01-19T23:29:58+05:30" title="2014-01-19 23:29">2014-01-19 23:29</time></a></p>
        </div>
    </header><div class="e-content entry-content">
    <div>
<p>Reading the disassembled code from the C programs which we can comfortably write is a great way to learn assembly language, do some archtecture specific optimizations and also to know what's happening under the hood.</p>
<p>In this post, we will see how to translate a small C program to assembly (using flat assembler).</p>
<p>Consider the following, where the code for gcd is taken from rosetta code:</p>
<table class="codetable"><tr>
<td class="linenos"><div class="linenodiv"><pre><a href="posts/c-code-to-assembly-using-gcc-and-gdb/#rest_code_531fbefbc3e7438eba41f0d8eaf9b1fc-0"> 0</a>
<a href="posts/c-code-to-assembly-using-gcc-and-gdb/#rest_code_531fbefbc3e7438eba41f0d8eaf9b1fc-1"> 1</a>
<a href="posts/c-code-to-assembly-using-gcc-and-gdb/#rest_code_531fbefbc3e7438eba41f0d8eaf9b1fc-2"> 2</a>
<a href="posts/c-code-to-assembly-using-gcc-and-gdb/#rest_code_531fbefbc3e7438eba41f0d8eaf9b1fc-3"> 3</a>
<a href="posts/c-code-to-assembly-using-gcc-and-gdb/#rest_code_531fbefbc3e7438eba41f0d8eaf9b1fc-4"> 4</a>
<a href="posts/c-code-to-assembly-using-gcc-and-gdb/#rest_code_531fbefbc3e7438eba41f0d8eaf9b1fc-5"> 5</a>
<a href="posts/c-code-to-assembly-using-gcc-and-gdb/#rest_code_531fbefbc3e7438eba41f0d8eaf9b1fc-6"> 6</a>
<a href="posts/c-code-to-assembly-using-gcc-and-gdb/#rest_code_531fbefbc3e7438eba41f0d8eaf9b1fc-7"> 7</a>
<a href="posts/c-code-to-assembly-using-gcc-and-gdb/#rest_code_531fbefbc3e7438eba41f0d8eaf9b1fc-8"> 8</a>
<a href="posts/c-code-to-assembly-using-gcc-and-gdb/#rest_code_531fbefbc3e7438eba41f0d8eaf9b1fc-9"> 9</a>
<a href="posts/c-code-to-assembly-using-gcc-and-gdb/#rest_code_531fbefbc3e7438eba41f0d8eaf9b1fc-10">10</a>
<a href="posts/c-code-to-assembly-using-gcc-and-gdb/#rest_code_531fbefbc3e7438eba41f0d8eaf9b1fc-11">11</a></pre></div></td>
<td class="code"><pre class="code C"><a name="rest_code_531fbefbc3e7438eba41f0d8eaf9b1fc-0"></a><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp"></span>
<a name="rest_code_531fbefbc3e7438eba41f0d8eaf9b1fc-1"></a>
<a name="rest_code_531fbefbc3e7438eba41f0d8eaf9b1fc-2"></a><span class="kt">int</span> <span class="nf">gcd</span><span class="p">(</span><span class="kt">int</span> <span class="n">u</span><span class="p">,</span> <span class="kt">int</span> <span class="n">v</span><span class="p">)</span> <span class="p">{</span>
<a name="rest_code_531fbefbc3e7438eba41f0d8eaf9b1fc-3"></a>    <span class="k">return</span> <span class="p">(</span><span class="n">v</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span><span class="o">?</span><span class="n">gcd</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">u</span><span class="o">%</span><span class="n">v</span><span class="p">)</span><span class="o">:</span><span class="n">u</span><span class="p">;</span>
<a name="rest_code_531fbefbc3e7438eba41f0d8eaf9b1fc-4"></a><span class="p">}</span>
<a name="rest_code_531fbefbc3e7438eba41f0d8eaf9b1fc-5"></a>
<a name="rest_code_531fbefbc3e7438eba41f0d8eaf9b1fc-6"></a><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
<a name="rest_code_531fbefbc3e7438eba41f0d8eaf9b1fc-7"></a>    <span class="kt">int</span> <span class="n">n</span><span class="p">,</span><span class="n">m</span><span class="p">;</span>
<a name="rest_code_531fbefbc3e7438eba41f0d8eaf9b1fc-8"></a>    <span class="n">scanf</span><span class="p">(</span><span class="s">"%d%d"</span><span class="p">,</span><span class="o">&amp;</span><span class="n">n</span><span class="p">,</span><span class="o">&amp;</span><span class="n">m</span><span class="p">);</span>
<a name="rest_code_531fbefbc3e7438eba41f0d8eaf9b1fc-9"></a>    <span class="n">printf</span><span class="p">(</span><span class="s">"%d </span><span class="se">\n</span><span class="s">"</span><span class="p">,</span><span class="n">gcd</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">m</span><span class="p">));</span>
<a name="rest_code_531fbefbc3e7438eba41f0d8eaf9b1fc-10"></a>    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<a name="rest_code_531fbefbc3e7438eba41f0d8eaf9b1fc-11"></a><span class="p">}</span>
</pre></td>
</tr></table>
<p>Compile to 32 bit code as</p>
<table class="codetable"><tr>
<td class="linenos"><div class="linenodiv"><pre><a href="posts/c-code-to-assembly-using-gcc-and-gdb/#rest_code_8bb1f197c7574726b9befb8776281ce0-0">0</a></pre></div></td>
<td class="code"><pre class="code bash"><a name="rest_code_8bb1f197c7574726b9befb8776281ce0-0"></a>gcc -o gcd gcd.c -m32
</pre></td>
</tr></table>
<p>and disassemble:</p>
<table class="codetable"><tr>
<td class="linenos"><div class="linenodiv"><pre><a href="posts/c-code-to-assembly-using-gcc-and-gdb/#rest_code_7a20ab610c4146328833363d3083464b-0">0</a>
<a href="posts/c-code-to-assembly-using-gcc-and-gdb/#rest_code_7a20ab610c4146328833363d3083464b-1">1</a></pre></div></td>
<td class="code"><pre class="code bash"><a name="rest_code_7a20ab610c4146328833363d3083464b-0"></a>gdb ./gcd
<a name="rest_code_7a20ab610c4146328833363d3083464b-1"></a><span class="o">(</span>gdb<span class="o">)</span> disas gcd
</pre></td>
</tr></table>
<p>We will see something like this:</p>
<table class="codetable"><tr>
<td class="linenos"><div class="linenodiv"><pre><a href="posts/c-code-to-assembly-using-gcc-and-gdb/#rest_code_60c7b0e6d2a143b4a83a7e2f133c0404-0"> 0</a>
<a href="posts/c-code-to-assembly-using-gcc-and-gdb/#rest_code_60c7b0e6d2a143b4a83a7e2f133c0404-1"> 1</a>
<a href="posts/c-code-to-assembly-using-gcc-and-gdb/#rest_code_60c7b0e6d2a143b4a83a7e2f133c0404-2"> 2</a>
<a href="posts/c-code-to-assembly-using-gcc-and-gdb/#rest_code_60c7b0e6d2a143b4a83a7e2f133c0404-3"> 3</a>
<a href="posts/c-code-to-assembly-using-gcc-and-gdb/#rest_code_60c7b0e6d2a143b4a83a7e2f133c0404-4"> 4</a>
<a href="posts/c-code-to-assembly-using-gcc-and-gdb/#rest_code_60c7b0e6d2a143b4a83a7e2f133c0404-5"> 5</a>
<a href="posts/c-code-to-assembly-using-gcc-and-gdb/#rest_code_60c7b0e6d2a143b4a83a7e2f133c0404-6"> 6</a>
<a href="posts/c-code-to-assembly-using-gcc-and-gdb/#rest_code_60c7b0e6d2a143b4a83a7e2f133c0404-7"> 7</a>
<a href="posts/c-code-to-assembly-using-gcc-and-gdb/#rest_code_60c7b0e6d2a143b4a83a7e2f133c0404-8"> 8</a>
<a href="posts/c-code-to-assembly-using-gcc-and-gdb/#rest_code_60c7b0e6d2a143b4a83a7e2f133c0404-9"> 9</a>
<a href="posts/c-code-to-assembly-using-gcc-and-gdb/#rest_code_60c7b0e6d2a143b4a83a7e2f133c0404-10">10</a>
<a href="posts/c-code-to-assembly-using-gcc-and-gdb/#rest_code_60c7b0e6d2a143b4a83a7e2f133c0404-11">11</a>
<a href="posts/c-code-to-assembly-using-gcc-and-gdb/#rest_code_60c7b0e6d2a143b4a83a7e2f133c0404-12">12</a>
<a href="posts/c-code-to-assembly-using-gcc-and-gdb/#rest_code_60c7b0e6d2a143b4a83a7e2f133c0404-13">13</a>
<a href="posts/c-code-to-assembly-using-gcc-and-gdb/#rest_code_60c7b0e6d2a143b4a83a7e2f133c0404-14">14</a>
<a href="posts/c-code-to-assembly-using-gcc-and-gdb/#rest_code_60c7b0e6d2a143b4a83a7e2f133c0404-15">15</a>
<a href="posts/c-code-to-assembly-using-gcc-and-gdb/#rest_code_60c7b0e6d2a143b4a83a7e2f133c0404-16">16</a>
<a href="posts/c-code-to-assembly-using-gcc-and-gdb/#rest_code_60c7b0e6d2a143b4a83a7e2f133c0404-17">17</a></pre></div></td>
<td class="code"><pre class="code asm"><a name="rest_code_60c7b0e6d2a143b4a83a7e2f133c0404-0"></a><span class="err">0</span><span class="nf">x08048454</span> <span class="err">&lt;+</span><span class="mi">0</span><span class="err">&gt;</span>  <span class="p">:</span>    <span class="no">push</span>   <span class="no">ebp</span>
<a name="rest_code_60c7b0e6d2a143b4a83a7e2f133c0404-1"></a><span class="err">0</span><span class="nf">x08048455</span> <span class="err">&lt;+</span><span class="mi">1</span><span class="err">&gt;</span>  <span class="p">:</span>    <span class="no">mov</span>    <span class="no">ebp</span><span class="p">,</span><span class="no">esp</span>
<a name="rest_code_60c7b0e6d2a143b4a83a7e2f133c0404-2"></a><span class="err">0</span><span class="nf">x08048457</span> <span class="err">&lt;+</span><span class="mi">3</span><span class="err">&gt;</span>  <span class="p">:</span>    <span class="no">sub</span>    <span class="no">esp</span><span class="p">,</span><span class="mi">0x18</span>
<a name="rest_code_60c7b0e6d2a143b4a83a7e2f133c0404-3"></a><span class="err">0</span><span class="nf">x0804845a</span> <span class="err">&lt;+</span><span class="mi">6</span><span class="err">&gt;</span>  <span class="p">:</span>    <span class="no">cmp</span>    <span class="no">DWORD</span> <span class="no">PTR</span> <span class="p">[</span><span class="no">ebp</span><span class="err">+</span><span class="mi">0xc</span><span class="p">],</span><span class="mi">0x0</span>
<a name="rest_code_60c7b0e6d2a143b4a83a7e2f133c0404-4"></a><span class="err">0</span><span class="nf">x0804845e</span> <span class="err">&lt;+</span><span class="mi">10</span><span class="err">&gt;</span> <span class="p">:</span>    <span class="no">je</span>     <span class="mh">0x804847e</span> <span class="p">&lt;</span><span class="no">gcd</span><span class="p">+</span><span class="mi">42</span><span class="p">&gt;</span>
<a name="rest_code_60c7b0e6d2a143b4a83a7e2f133c0404-5"></a><span class="err">0</span><span class="nf">x08048460</span> <span class="err">&lt;+</span><span class="mi">12</span><span class="err">&gt;</span> <span class="p">:</span>    <span class="no">mov</span>    <span class="no">eax</span><span class="p">,</span><span class="no">DWORD</span> <span class="no">PTR</span> <span class="p">[</span><span class="no">ebp</span><span class="err">+</span><span class="mi">0x8</span><span class="p">]</span>
<a name="rest_code_60c7b0e6d2a143b4a83a7e2f133c0404-6"></a><span class="err">0</span><span class="nf">x08048463</span> <span class="err">&lt;+</span><span class="mi">15</span><span class="err">&gt;</span> <span class="p">:</span>    <span class="no">mov</span>    <span class="no">edx</span><span class="p">,</span><span class="no">eax</span>
<a name="rest_code_60c7b0e6d2a143b4a83a7e2f133c0404-7"></a><span class="err">0</span><span class="nf">x08048465</span> <span class="err">&lt;+</span><span class="mi">17</span><span class="err">&gt;</span> <span class="p">:</span>    <span class="no">sar</span>    <span class="no">edx</span><span class="p">,</span><span class="mi">0x1f</span>
<a name="rest_code_60c7b0e6d2a143b4a83a7e2f133c0404-8"></a><span class="err">0</span><span class="nf">x08048468</span> <span class="err">&lt;+</span><span class="mi">20</span><span class="err">&gt;</span> <span class="p">:</span>    <span class="no">idiv</span>   <span class="no">DWORD</span> <span class="no">PTR</span> <span class="p">[</span><span class="no">ebp</span><span class="err">+</span><span class="mi">0xc</span><span class="p">]</span>
<a name="rest_code_60c7b0e6d2a143b4a83a7e2f133c0404-9"></a><span class="err">0</span><span class="nf">x0804846b</span> <span class="err">&lt;+</span><span class="mi">23</span><span class="err">&gt;</span> <span class="p">:</span>    <span class="no">mov</span>    <span class="no">eax</span><span class="p">,</span><span class="no">edx</span>
<a name="rest_code_60c7b0e6d2a143b4a83a7e2f133c0404-10"></a><span class="err">0</span><span class="nf">x0804846d</span> <span class="err">&lt;+</span><span class="mi">25</span><span class="err">&gt;</span> <span class="p">:</span>    <span class="no">mov</span>    <span class="no">DWORD</span> <span class="no">PTR</span> <span class="p">[</span><span class="no">esp</span><span class="err">+</span><span class="mi">0x4</span><span class="p">],</span><span class="no">eax</span>
<a name="rest_code_60c7b0e6d2a143b4a83a7e2f133c0404-11"></a><span class="err">0</span><span class="nf">x08048471</span> <span class="err">&lt;+</span><span class="mi">29</span><span class="err">&gt;</span> <span class="p">:</span>    <span class="no">mov</span>    <span class="no">eax</span><span class="p">,</span><span class="no">DWORD</span> <span class="no">PTR</span> <span class="p">[</span><span class="no">ebp</span><span class="err">+</span><span class="mi">0xc</span><span class="p">]</span>
<a name="rest_code_60c7b0e6d2a143b4a83a7e2f133c0404-12"></a><span class="err">0</span><span class="nf">x08048474</span> <span class="err">&lt;+</span><span class="mi">32</span><span class="err">&gt;</span> <span class="p">:</span>    <span class="no">mov</span>    <span class="no">DWORD</span> <span class="no">PTR</span> <span class="p">[</span><span class="no">esp</span><span class="p">],</span><span class="no">eax</span>
<a name="rest_code_60c7b0e6d2a143b4a83a7e2f133c0404-13"></a><span class="err">0</span><span class="nf">x08048477</span> <span class="err">&lt;+</span><span class="mi">35</span><span class="err">&gt;</span> <span class="p">:</span>    <span class="no">call</span>   <span class="mh">0x8048454</span> <span class="p">&lt;</span><span class="no">gcd</span><span class="p">&gt;</span>
<a name="rest_code_60c7b0e6d2a143b4a83a7e2f133c0404-14"></a><span class="err">0</span><span class="nf">x0804847c</span> <span class="err">&lt;+</span><span class="mi">40</span><span class="err">&gt;</span> <span class="p">:</span>    <span class="no">jmp</span>    <span class="mh">0x8048481</span> <span class="p">&lt;</span><span class="no">gcd</span><span class="p">+</span><span class="mi">45</span><span class="p">&gt;</span>
<a name="rest_code_60c7b0e6d2a143b4a83a7e2f133c0404-15"></a><span class="err">0</span><span class="nf">x0804847e</span> <span class="err">&lt;+</span><span class="mi">42</span><span class="err">&gt;</span> <span class="p">:</span>    <span class="no">mov</span>    <span class="no">eax</span><span class="p">,</span><span class="no">DWORD</span> <span class="no">PTR</span> <span class="p">[</span><span class="no">ebp</span><span class="err">+</span><span class="mi">0x8</span><span class="p">]</span>
<a name="rest_code_60c7b0e6d2a143b4a83a7e2f133c0404-16"></a><span class="err">0</span><span class="nf">x08048481</span> <span class="err">&lt;+</span><span class="mi">45</span><span class="err">&gt;</span> <span class="p">:</span>    <span class="no">leave</span>
<a name="rest_code_60c7b0e6d2a143b4a83a7e2f133c0404-17"></a><span class="err">0</span><span class="nf">x08048482</span> <span class="err">&lt;+</span><span class="mi">46</span><span class="err">&gt;</span> <span class="p">:</span>    <span class="no">ret</span>
</pre></td>
</tr></table>
<p>and</p>
<table class="codetable"><tr>
<td class="linenos"><div class="linenodiv"><pre><a href="posts/c-code-to-assembly-using-gcc-and-gdb/#rest_code_cd0407e08c9c4056ae2bf5defe206873-0">0</a></pre></div></td>
<td class="code"><pre class="code bash"><a name="rest_code_cd0407e08c9c4056ae2bf5defe206873-0"></a><span class="o">(</span>gdb<span class="o">)</span> disas main
</pre></td>
</tr></table>
<p>shows like this:</p>
<table class="codetable"><tr>
<td class="linenos"><div class="linenodiv"><pre><a href="posts/c-code-to-assembly-using-gcc-and-gdb/#rest_code_d7c75249db5d452087cea68422a67cb4-0"> 0</a>
<a href="posts/c-code-to-assembly-using-gcc-and-gdb/#rest_code_d7c75249db5d452087cea68422a67cb4-1"> 1</a>
<a href="posts/c-code-to-assembly-using-gcc-and-gdb/#rest_code_d7c75249db5d452087cea68422a67cb4-2"> 2</a>
<a href="posts/c-code-to-assembly-using-gcc-and-gdb/#rest_code_d7c75249db5d452087cea68422a67cb4-3"> 3</a>
<a href="posts/c-code-to-assembly-using-gcc-and-gdb/#rest_code_d7c75249db5d452087cea68422a67cb4-4"> 4</a>
<a href="posts/c-code-to-assembly-using-gcc-and-gdb/#rest_code_d7c75249db5d452087cea68422a67cb4-5"> 5</a>
<a href="posts/c-code-to-assembly-using-gcc-and-gdb/#rest_code_d7c75249db5d452087cea68422a67cb4-6"> 6</a>
<a href="posts/c-code-to-assembly-using-gcc-and-gdb/#rest_code_d7c75249db5d452087cea68422a67cb4-7"> 7</a>
<a href="posts/c-code-to-assembly-using-gcc-and-gdb/#rest_code_d7c75249db5d452087cea68422a67cb4-8"> 8</a>
<a href="posts/c-code-to-assembly-using-gcc-and-gdb/#rest_code_d7c75249db5d452087cea68422a67cb4-9"> 9</a>
<a href="posts/c-code-to-assembly-using-gcc-and-gdb/#rest_code_d7c75249db5d452087cea68422a67cb4-10">10</a>
<a href="posts/c-code-to-assembly-using-gcc-and-gdb/#rest_code_d7c75249db5d452087cea68422a67cb4-11">11</a>
<a href="posts/c-code-to-assembly-using-gcc-and-gdb/#rest_code_d7c75249db5d452087cea68422a67cb4-12">12</a>
<a href="posts/c-code-to-assembly-using-gcc-and-gdb/#rest_code_d7c75249db5d452087cea68422a67cb4-13">13</a>
<a href="posts/c-code-to-assembly-using-gcc-and-gdb/#rest_code_d7c75249db5d452087cea68422a67cb4-14">14</a>
<a href="posts/c-code-to-assembly-using-gcc-and-gdb/#rest_code_d7c75249db5d452087cea68422a67cb4-15">15</a>
<a href="posts/c-code-to-assembly-using-gcc-and-gdb/#rest_code_d7c75249db5d452087cea68422a67cb4-16">16</a>
<a href="posts/c-code-to-assembly-using-gcc-and-gdb/#rest_code_d7c75249db5d452087cea68422a67cb4-17">17</a>
<a href="posts/c-code-to-assembly-using-gcc-and-gdb/#rest_code_d7c75249db5d452087cea68422a67cb4-18">18</a>
<a href="posts/c-code-to-assembly-using-gcc-and-gdb/#rest_code_d7c75249db5d452087cea68422a67cb4-19">19</a>
<a href="posts/c-code-to-assembly-using-gcc-and-gdb/#rest_code_d7c75249db5d452087cea68422a67cb4-20">20</a>
<a href="posts/c-code-to-assembly-using-gcc-and-gdb/#rest_code_d7c75249db5d452087cea68422a67cb4-21">21</a>
<a href="posts/c-code-to-assembly-using-gcc-and-gdb/#rest_code_d7c75249db5d452087cea68422a67cb4-22">22</a></pre></div></td>
<td class="code"><pre class="code asm"><a name="rest_code_d7c75249db5d452087cea68422a67cb4-0"></a><span class="err">0</span><span class="nf">x08048483</span> <span class="err">&lt;+</span><span class="mi">0</span><span class="err">&gt;</span>  <span class="p">:</span>    <span class="no">push</span>   <span class="no">ebp</span>
<a name="rest_code_d7c75249db5d452087cea68422a67cb4-1"></a><span class="err">0</span><span class="nf">x08048484</span> <span class="err">&lt;+</span><span class="mi">1</span><span class="err">&gt;</span>  <span class="p">:</span>    <span class="no">mov</span>    <span class="no">ebp</span><span class="p">,</span><span class="no">esp</span>
<a name="rest_code_d7c75249db5d452087cea68422a67cb4-2"></a><span class="err">0</span><span class="nf">x08048486</span> <span class="err">&lt;+</span><span class="mi">3</span><span class="err">&gt;</span>  <span class="p">:</span>    <span class="no">and</span>    <span class="no">esp</span><span class="p">,</span><span class="mi">0xfffffff0</span>
<a name="rest_code_d7c75249db5d452087cea68422a67cb4-3"></a><span class="err">0</span><span class="nf">x08048489</span> <span class="err">&lt;+</span><span class="mi">6</span><span class="err">&gt;</span>  <span class="p">:</span>    <span class="no">sub</span>    <span class="no">esp</span><span class="p">,</span><span class="mi">0x20</span>
<a name="rest_code_d7c75249db5d452087cea68422a67cb4-4"></a><span class="err">0</span><span class="nf">x0804848c</span> <span class="err">&lt;+</span><span class="mi">9</span><span class="err">&gt;</span>  <span class="p">:</span>    <span class="no">mov</span>    <span class="no">eax</span><span class="p">,</span><span class="mi">0x80485b0</span>
<a name="rest_code_d7c75249db5d452087cea68422a67cb4-5"></a><span class="err">0</span><span class="nf">x08048491</span> <span class="err">&lt;+</span><span class="mi">14</span><span class="err">&gt;</span> <span class="p">:</span>    <span class="no">lea</span>    <span class="no">edx</span><span class="p">,[</span><span class="no">esp</span><span class="err">+</span><span class="mi">0x1c</span><span class="p">]</span>
<a name="rest_code_d7c75249db5d452087cea68422a67cb4-6"></a><span class="err">0</span><span class="nf">x08048495</span> <span class="err">&lt;+</span><span class="mi">18</span><span class="err">&gt;</span> <span class="p">:</span>    <span class="no">mov</span>    <span class="no">DWORD</span> <span class="no">PTR</span> <span class="p">[</span><span class="no">esp</span><span class="err">+</span><span class="mi">0x8</span><span class="p">],</span><span class="no">edx</span>
<a name="rest_code_d7c75249db5d452087cea68422a67cb4-7"></a><span class="err">0</span><span class="nf">x08048499</span> <span class="err">&lt;+</span><span class="mi">22</span><span class="err">&gt;</span> <span class="p">:</span>    <span class="no">lea</span>    <span class="no">edx</span><span class="p">,[</span><span class="no">esp</span><span class="err">+</span><span class="mi">0x18</span><span class="p">]</span>
<a name="rest_code_d7c75249db5d452087cea68422a67cb4-8"></a><span class="err">0</span><span class="nf">x0804849d</span> <span class="err">&lt;+</span><span class="mi">26</span><span class="err">&gt;</span> <span class="p">:</span>    <span class="no">mov</span>    <span class="no">DWORD</span> <span class="no">PTR</span> <span class="p">[</span><span class="no">esp</span><span class="err">+</span><span class="mi">0x4</span><span class="p">],</span><span class="no">edx</span>
<a name="rest_code_d7c75249db5d452087cea68422a67cb4-9"></a><span class="err">0</span><span class="nf">x080484a1</span> <span class="err">&lt;+</span><span class="mi">30</span><span class="err">&gt;</span> <span class="p">:</span>    <span class="no">mov</span>    <span class="no">DWORD</span> <span class="no">PTR</span> <span class="p">[</span><span class="no">esp</span><span class="p">],</span><span class="no">eax</span>
<a name="rest_code_d7c75249db5d452087cea68422a67cb4-10"></a><span class="err">0</span><span class="nf">x080484a4</span> <span class="err">&lt;+</span><span class="mi">33</span><span class="err">&gt;</span> <span class="p">:</span>    <span class="no">call</span>   <span class="mh">0x8048380</span> <span class="p">&lt;</span><span class="no">__isoc99_scanf@plt</span><span class="p">&gt;</span>
<a name="rest_code_d7c75249db5d452087cea68422a67cb4-11"></a><span class="err">0</span><span class="nf">x080484a9</span> <span class="err">&lt;+</span><span class="mi">38</span><span class="err">&gt;</span> <span class="p">:</span>    <span class="no">mov</span>    <span class="no">edx</span><span class="p">,</span><span class="no">DWORD</span> <span class="no">PTR</span> <span class="p">[</span><span class="no">esp</span><span class="err">+</span><span class="mi">0x1c</span><span class="p">]</span>
<a name="rest_code_d7c75249db5d452087cea68422a67cb4-12"></a><span class="err">0</span><span class="nf">x080484ad</span> <span class="err">&lt;+</span><span class="mi">42</span><span class="err">&gt;</span> <span class="p">:</span>    <span class="no">mov</span>    <span class="no">eax</span><span class="p">,</span><span class="no">DWORD</span> <span class="no">PTR</span> <span class="p">[</span><span class="no">esp</span><span class="err">+</span><span class="mi">0x18</span><span class="p">]</span>
<a name="rest_code_d7c75249db5d452087cea68422a67cb4-13"></a><span class="err">0</span><span class="nf">x080484b1</span> <span class="err">&lt;+</span><span class="mi">46</span><span class="err">&gt;</span> <span class="p">:</span>    <span class="no">mov</span>    <span class="no">DWORD</span> <span class="no">PTR</span> <span class="p">[</span><span class="no">esp</span><span class="err">+</span><span class="mi">0x4</span><span class="p">],</span><span class="no">edx</span>
<a name="rest_code_d7c75249db5d452087cea68422a67cb4-14"></a><span class="err">0</span><span class="nf">x080484b5</span> <span class="err">&lt;+</span><span class="mi">50</span><span class="err">&gt;</span> <span class="p">:</span>    <span class="no">mov</span>    <span class="no">DWORD</span> <span class="no">PTR</span> <span class="p">[</span><span class="no">esp</span><span class="p">],</span><span class="no">eax</span>
<a name="rest_code_d7c75249db5d452087cea68422a67cb4-15"></a><span class="err">0</span><span class="nf">x080484b8</span> <span class="err">&lt;+</span><span class="mi">53</span><span class="err">&gt;</span> <span class="p">:</span>    <span class="no">call</span>   <span class="mh">0x8048454</span> <span class="p">&lt;</span><span class="no">gcd</span><span class="p">&gt;</span>
<a name="rest_code_d7c75249db5d452087cea68422a67cb4-16"></a><span class="err">0</span><span class="nf">x080484bd</span> <span class="err">&lt;+</span><span class="mi">58</span><span class="err">&gt;</span> <span class="p">:</span>    <span class="no">mov</span>    <span class="no">edx</span><span class="p">,</span><span class="mi">0x80485b5</span>
<a name="rest_code_d7c75249db5d452087cea68422a67cb4-17"></a><span class="err">0</span><span class="nf">x080484c2</span> <span class="err">&lt;+</span><span class="mi">63</span><span class="err">&gt;</span> <span class="p">:</span>    <span class="no">mov</span>    <span class="no">DWORD</span> <span class="no">PTR</span> <span class="p">[</span><span class="no">esp</span><span class="err">+</span><span class="mi">0x4</span><span class="p">],</span><span class="no">eax</span>
<a name="rest_code_d7c75249db5d452087cea68422a67cb4-18"></a><span class="err">0</span><span class="nf">x080484c6</span> <span class="err">&lt;+</span><span class="mi">67</span><span class="err">&gt;</span> <span class="p">:</span>    <span class="no">mov</span>    <span class="no">DWORD</span> <span class="no">PTR</span> <span class="p">[</span><span class="no">esp</span><span class="p">],</span><span class="no">edx</span>
<a name="rest_code_d7c75249db5d452087cea68422a67cb4-19"></a><span class="err">0</span><span class="nf">x080484c9</span> <span class="err">&lt;+</span><span class="mi">70</span><span class="err">&gt;</span> <span class="p">:</span>    <span class="no">call</span>   <span class="mh">0x8048390</span> <span class="p">&lt;</span><span class="no">printf@plt</span><span class="p">&gt;</span>
<a name="rest_code_d7c75249db5d452087cea68422a67cb4-20"></a><span class="err">0</span><span class="nf">x080484ce</span> <span class="err">&lt;+</span><span class="mi">75</span><span class="err">&gt;</span> <span class="p">:</span>    <span class="no">mov</span>    <span class="no">eax</span><span class="p">,</span><span class="mi">0x0</span>
<a name="rest_code_d7c75249db5d452087cea68422a67cb4-21"></a><span class="err">0</span><span class="nf">x080484d3</span> <span class="err">&lt;+</span><span class="mi">80</span><span class="err">&gt;</span> <span class="p">:</span>    <span class="no">leave</span>
<a name="rest_code_d7c75249db5d452087cea68422a67cb4-22"></a><span class="err">0</span><span class="nf">x080484d4</span> <span class="err">&lt;+</span><span class="mi">81</span><span class="err">&gt;</span> <span class="p">:</span>    <span class="no">ret</span>
</pre></td>
</tr></table>
<p>From the disassembly, we can see that the function arguments are pushed from right to left.
We can also see that the local variables are allocated space in the stack.</p>
<p>We need to replace all the relative references by labels, memory references by names and remove all "PTR" keywords.
Using the example to produce dynamically linked executable from fasm for linux (doing it in 1.70.03), we may write it as:</p>
<table class="codetable"><tr>
<td class="linenos"><div class="linenodiv"><pre><a href="posts/c-code-to-assembly-using-gcc-and-gdb/#rest_code_4928b01331944a5ba27e0a21c8938c40-0"> 0</a>
<a href="posts/c-code-to-assembly-using-gcc-and-gdb/#rest_code_4928b01331944a5ba27e0a21c8938c40-1"> 1</a>
<a href="posts/c-code-to-assembly-using-gcc-and-gdb/#rest_code_4928b01331944a5ba27e0a21c8938c40-2"> 2</a>
<a href="posts/c-code-to-assembly-using-gcc-and-gdb/#rest_code_4928b01331944a5ba27e0a21c8938c40-3"> 3</a>
<a href="posts/c-code-to-assembly-using-gcc-and-gdb/#rest_code_4928b01331944a5ba27e0a21c8938c40-4"> 4</a>
<a href="posts/c-code-to-assembly-using-gcc-and-gdb/#rest_code_4928b01331944a5ba27e0a21c8938c40-5"> 5</a>
<a href="posts/c-code-to-assembly-using-gcc-and-gdb/#rest_code_4928b01331944a5ba27e0a21c8938c40-6"> 6</a>
<a href="posts/c-code-to-assembly-using-gcc-and-gdb/#rest_code_4928b01331944a5ba27e0a21c8938c40-7"> 7</a>
<a href="posts/c-code-to-assembly-using-gcc-and-gdb/#rest_code_4928b01331944a5ba27e0a21c8938c40-8"> 8</a>
<a href="posts/c-code-to-assembly-using-gcc-and-gdb/#rest_code_4928b01331944a5ba27e0a21c8938c40-9"> 9</a>
<a href="posts/c-code-to-assembly-using-gcc-and-gdb/#rest_code_4928b01331944a5ba27e0a21c8938c40-10">10</a>
<a href="posts/c-code-to-assembly-using-gcc-and-gdb/#rest_code_4928b01331944a5ba27e0a21c8938c40-11">11</a>
<a href="posts/c-code-to-assembly-using-gcc-and-gdb/#rest_code_4928b01331944a5ba27e0a21c8938c40-12">12</a>
<a href="posts/c-code-to-assembly-using-gcc-and-gdb/#rest_code_4928b01331944a5ba27e0a21c8938c40-13">13</a>
<a href="posts/c-code-to-assembly-using-gcc-and-gdb/#rest_code_4928b01331944a5ba27e0a21c8938c40-14">14</a>
<a href="posts/c-code-to-assembly-using-gcc-and-gdb/#rest_code_4928b01331944a5ba27e0a21c8938c40-15">15</a>
<a href="posts/c-code-to-assembly-using-gcc-and-gdb/#rest_code_4928b01331944a5ba27e0a21c8938c40-16">16</a>
<a href="posts/c-code-to-assembly-using-gcc-and-gdb/#rest_code_4928b01331944a5ba27e0a21c8938c40-17">17</a>
<a href="posts/c-code-to-assembly-using-gcc-and-gdb/#rest_code_4928b01331944a5ba27e0a21c8938c40-18">18</a>
<a href="posts/c-code-to-assembly-using-gcc-and-gdb/#rest_code_4928b01331944a5ba27e0a21c8938c40-19">19</a>
<a href="posts/c-code-to-assembly-using-gcc-and-gdb/#rest_code_4928b01331944a5ba27e0a21c8938c40-20">20</a>
<a href="posts/c-code-to-assembly-using-gcc-and-gdb/#rest_code_4928b01331944a5ba27e0a21c8938c40-21">21</a>
<a href="posts/c-code-to-assembly-using-gcc-and-gdb/#rest_code_4928b01331944a5ba27e0a21c8938c40-22">22</a>
<a href="posts/c-code-to-assembly-using-gcc-and-gdb/#rest_code_4928b01331944a5ba27e0a21c8938c40-23">23</a>
<a href="posts/c-code-to-assembly-using-gcc-and-gdb/#rest_code_4928b01331944a5ba27e0a21c8938c40-24">24</a>
<a href="posts/c-code-to-assembly-using-gcc-and-gdb/#rest_code_4928b01331944a5ba27e0a21c8938c40-25">25</a>
<a href="posts/c-code-to-assembly-using-gcc-and-gdb/#rest_code_4928b01331944a5ba27e0a21c8938c40-26">26</a>
<a href="posts/c-code-to-assembly-using-gcc-and-gdb/#rest_code_4928b01331944a5ba27e0a21c8938c40-27">27</a>
<a href="posts/c-code-to-assembly-using-gcc-and-gdb/#rest_code_4928b01331944a5ba27e0a21c8938c40-28">28</a>
<a href="posts/c-code-to-assembly-using-gcc-and-gdb/#rest_code_4928b01331944a5ba27e0a21c8938c40-29">29</a>
<a href="posts/c-code-to-assembly-using-gcc-and-gdb/#rest_code_4928b01331944a5ba27e0a21c8938c40-30">30</a>
<a href="posts/c-code-to-assembly-using-gcc-and-gdb/#rest_code_4928b01331944a5ba27e0a21c8938c40-31">31</a>
<a href="posts/c-code-to-assembly-using-gcc-and-gdb/#rest_code_4928b01331944a5ba27e0a21c8938c40-32">32</a>
<a href="posts/c-code-to-assembly-using-gcc-and-gdb/#rest_code_4928b01331944a5ba27e0a21c8938c40-33">33</a>
<a href="posts/c-code-to-assembly-using-gcc-and-gdb/#rest_code_4928b01331944a5ba27e0a21c8938c40-34">34</a>
<a href="posts/c-code-to-assembly-using-gcc-and-gdb/#rest_code_4928b01331944a5ba27e0a21c8938c40-35">35</a>
<a href="posts/c-code-to-assembly-using-gcc-and-gdb/#rest_code_4928b01331944a5ba27e0a21c8938c40-36">36</a>
<a href="posts/c-code-to-assembly-using-gcc-and-gdb/#rest_code_4928b01331944a5ba27e0a21c8938c40-37">37</a>
<a href="posts/c-code-to-assembly-using-gcc-and-gdb/#rest_code_4928b01331944a5ba27e0a21c8938c40-38">38</a>
<a href="posts/c-code-to-assembly-using-gcc-and-gdb/#rest_code_4928b01331944a5ba27e0a21c8938c40-39">39</a>
<a href="posts/c-code-to-assembly-using-gcc-and-gdb/#rest_code_4928b01331944a5ba27e0a21c8938c40-40">40</a>
<a href="posts/c-code-to-assembly-using-gcc-and-gdb/#rest_code_4928b01331944a5ba27e0a21c8938c40-41">41</a>
<a href="posts/c-code-to-assembly-using-gcc-and-gdb/#rest_code_4928b01331944a5ba27e0a21c8938c40-42">42</a>
<a href="posts/c-code-to-assembly-using-gcc-and-gdb/#rest_code_4928b01331944a5ba27e0a21c8938c40-43">43</a>
<a href="posts/c-code-to-assembly-using-gcc-and-gdb/#rest_code_4928b01331944a5ba27e0a21c8938c40-44">44</a>
<a href="posts/c-code-to-assembly-using-gcc-and-gdb/#rest_code_4928b01331944a5ba27e0a21c8938c40-45">45</a>
<a href="posts/c-code-to-assembly-using-gcc-and-gdb/#rest_code_4928b01331944a5ba27e0a21c8938c40-46">46</a>
<a href="posts/c-code-to-assembly-using-gcc-and-gdb/#rest_code_4928b01331944a5ba27e0a21c8938c40-47">47</a>
<a href="posts/c-code-to-assembly-using-gcc-and-gdb/#rest_code_4928b01331944a5ba27e0a21c8938c40-48">48</a>
<a href="posts/c-code-to-assembly-using-gcc-and-gdb/#rest_code_4928b01331944a5ba27e0a21c8938c40-49">49</a>
<a href="posts/c-code-to-assembly-using-gcc-and-gdb/#rest_code_4928b01331944a5ba27e0a21c8938c40-50">50</a>
<a href="posts/c-code-to-assembly-using-gcc-and-gdb/#rest_code_4928b01331944a5ba27e0a21c8938c40-51">51</a>
<a href="posts/c-code-to-assembly-using-gcc-and-gdb/#rest_code_4928b01331944a5ba27e0a21c8938c40-52">52</a>
<a href="posts/c-code-to-assembly-using-gcc-and-gdb/#rest_code_4928b01331944a5ba27e0a21c8938c40-53">53</a></pre></div></td>
<td class="code"><pre class="code asm"><a name="rest_code_4928b01331944a5ba27e0a21c8938c40-0"></a><span class="nf">format</span> <span class="no">ELF</span> <span class="no">executable</span> <span class="mi">3</span>
<a name="rest_code_4928b01331944a5ba27e0a21c8938c40-1"></a><span class="nf">entry</span> <span class="no">start</span>
<a name="rest_code_4928b01331944a5ba27e0a21c8938c40-2"></a>
<a name="rest_code_4928b01331944a5ba27e0a21c8938c40-3"></a><span class="nf">include</span>      <span class="err">'</span><span class="no">import32.inc</span><span class="err">'</span>
<a name="rest_code_4928b01331944a5ba27e0a21c8938c40-4"></a><span class="nf">include</span>      <span class="err">'</span><span class="no">proc32.inc</span><span class="err">'</span>
<a name="rest_code_4928b01331944a5ba27e0a21c8938c40-5"></a>
<a name="rest_code_4928b01331944a5ba27e0a21c8938c40-6"></a><span class="nf">interpreter</span>  <span class="err">'/</span><span class="no">lib</span><span class="err">/</span><span class="no">ld-linux.so.2</span><span class="err">'</span>
<a name="rest_code_4928b01331944a5ba27e0a21c8938c40-7"></a><span class="nf">needed</span>       <span class="err">'</span><span class="no">libc.so.6</span><span class="err">'</span>
<a name="rest_code_4928b01331944a5ba27e0a21c8938c40-8"></a><span class="nf">import</span>       <span class="no">printf</span><span class="p">,</span><span class="no">scanf</span><span class="p">,</span><span class="no">exit</span>
<a name="rest_code_4928b01331944a5ba27e0a21c8938c40-9"></a>
<a name="rest_code_4928b01331944a5ba27e0a21c8938c40-10"></a><span class="nf">segment</span> <span class="no">readable</span> <span class="no">executable</span>
<a name="rest_code_4928b01331944a5ba27e0a21c8938c40-11"></a>
<a name="rest_code_4928b01331944a5ba27e0a21c8938c40-12"></a><span class="nl">gcd:</span>
<a name="rest_code_4928b01331944a5ba27e0a21c8938c40-13"></a><span class="nf">push</span>   <span class="no">ebp</span>
<a name="rest_code_4928b01331944a5ba27e0a21c8938c40-14"></a><span class="nf">mov</span>    <span class="no">ebp</span><span class="p">,</span><span class="no">esp</span>
<a name="rest_code_4928b01331944a5ba27e0a21c8938c40-15"></a><span class="nf">sub</span>    <span class="no">esp</span><span class="p">,</span><span class="mi">0x18</span>
<a name="rest_code_4928b01331944a5ba27e0a21c8938c40-16"></a><span class="nf">cmp</span>    <span class="no">DWORD</span> <span class="p">[</span><span class="no">ebp</span><span class="err">+</span><span class="mi">0xc</span><span class="p">],</span><span class="mi">0x0</span>
<a name="rest_code_4928b01331944a5ba27e0a21c8938c40-17"></a><span class="nf">je</span>     <span class="no">l1</span>
<a name="rest_code_4928b01331944a5ba27e0a21c8938c40-18"></a><span class="nf">mov</span>    <span class="no">eax</span><span class="p">,</span><span class="no">DWORD</span> <span class="p">[</span><span class="no">ebp</span><span class="err">+</span><span class="mi">0x8</span><span class="p">]</span>
<a name="rest_code_4928b01331944a5ba27e0a21c8938c40-19"></a><span class="nf">mov</span>    <span class="no">edx</span><span class="p">,</span><span class="no">eax</span>
<a name="rest_code_4928b01331944a5ba27e0a21c8938c40-20"></a><span class="nf">sar</span>    <span class="no">edx</span><span class="p">,</span><span class="mi">0x1f</span>
<a name="rest_code_4928b01331944a5ba27e0a21c8938c40-21"></a><span class="nf">idiv</span>   <span class="no">DWORD</span> <span class="p">[</span><span class="no">ebp</span><span class="err">+</span><span class="mi">0xc</span><span class="p">]</span>
<a name="rest_code_4928b01331944a5ba27e0a21c8938c40-22"></a><span class="nf">mov</span>    <span class="no">eax</span><span class="p">,</span><span class="no">edx</span>
<a name="rest_code_4928b01331944a5ba27e0a21c8938c40-23"></a><span class="nf">mov</span>    <span class="no">DWORD</span> <span class="p">[</span><span class="no">esp</span><span class="err">+</span><span class="mi">0x4</span><span class="p">],</span><span class="no">eax</span>
<a name="rest_code_4928b01331944a5ba27e0a21c8938c40-24"></a><span class="nf">mov</span>    <span class="no">eax</span><span class="p">,</span><span class="no">DWORD</span> <span class="p">[</span><span class="no">ebp</span><span class="err">+</span><span class="mi">0xc</span><span class="p">]</span>
<a name="rest_code_4928b01331944a5ba27e0a21c8938c40-25"></a><span class="nf">mov</span>    <span class="no">DWORD</span> <span class="p">[</span><span class="no">esp</span><span class="p">],</span><span class="no">eax</span>
<a name="rest_code_4928b01331944a5ba27e0a21c8938c40-26"></a><span class="nf">call</span>   <span class="no">gcd</span>
<a name="rest_code_4928b01331944a5ba27e0a21c8938c40-27"></a><span class="nf">jmp</span>    <span class="no">l2</span>
<a name="rest_code_4928b01331944a5ba27e0a21c8938c40-28"></a><span class="nl">l1:</span>
<a name="rest_code_4928b01331944a5ba27e0a21c8938c40-29"></a><span class="nf">mov</span>    <span class="no">eax</span><span class="p">,</span><span class="no">DWORD</span> <span class="p">[</span><span class="no">ebp</span><span class="err">+</span><span class="mi">0x8</span><span class="p">]</span>
<a name="rest_code_4928b01331944a5ba27e0a21c8938c40-30"></a><span class="nl">l2:</span>
<a name="rest_code_4928b01331944a5ba27e0a21c8938c40-31"></a><span class="nf">leave</span>
<a name="rest_code_4928b01331944a5ba27e0a21c8938c40-32"></a><span class="nf">ret</span>
<a name="rest_code_4928b01331944a5ba27e0a21c8938c40-33"></a>
<a name="rest_code_4928b01331944a5ba27e0a21c8938c40-34"></a><span class="nl">start:</span>
<a name="rest_code_4928b01331944a5ba27e0a21c8938c40-35"></a><span class="nf">push</span>     <span class="no">ebp</span>
<a name="rest_code_4928b01331944a5ba27e0a21c8938c40-36"></a><span class="nf">mov</span>      <span class="no">ebp</span><span class="p">,</span><span class="no">esp</span>
<a name="rest_code_4928b01331944a5ba27e0a21c8938c40-37"></a><span class="nf">and</span>      <span class="no">esp</span><span class="p">,</span><span class="mi">0xfffffff0</span>
<a name="rest_code_4928b01331944a5ba27e0a21c8938c40-38"></a><span class="nf">sub</span>      <span class="no">esp</span><span class="p">,</span><span class="mi">0x20</span>
<a name="rest_code_4928b01331944a5ba27e0a21c8938c40-39"></a><span class="nf">cinvoke</span>  <span class="no">scanf</span><span class="p">,</span><span class="no">pars</span><span class="p">,</span><span class="no">n</span><span class="p">,</span><span class="no">m</span>
<a name="rest_code_4928b01331944a5ba27e0a21c8938c40-40"></a><span class="nf">mov</span>      <span class="no">edx</span><span class="p">,[</span><span class="no">n</span><span class="p">]</span>
<a name="rest_code_4928b01331944a5ba27e0a21c8938c40-41"></a><span class="nf">mov</span>      <span class="no">eax</span><span class="p">,[</span><span class="no">m</span><span class="p">]</span>
<a name="rest_code_4928b01331944a5ba27e0a21c8938c40-42"></a><span class="nf">mov</span>      <span class="no">DWORD</span>  <span class="p">[</span><span class="no">esp</span><span class="err">+</span><span class="mi">0x4</span><span class="p">],</span><span class="no">edx</span>
<a name="rest_code_4928b01331944a5ba27e0a21c8938c40-43"></a><span class="nf">mov</span>      <span class="no">DWORD</span>  <span class="p">[</span><span class="no">esp</span><span class="p">],</span><span class="no">eax</span>
<a name="rest_code_4928b01331944a5ba27e0a21c8938c40-44"></a><span class="nf">call</span>     <span class="no">gcd</span>
<a name="rest_code_4928b01331944a5ba27e0a21c8938c40-45"></a><span class="nf">cinvoke</span>  <span class="no">printf</span><span class="p">,</span><span class="no">parspf</span><span class="p">,</span><span class="no">eax</span>
<a name="rest_code_4928b01331944a5ba27e0a21c8938c40-46"></a><span class="nf">mov</span>      <span class="no">eax</span><span class="p">,</span><span class="mi">0x0</span>
<a name="rest_code_4928b01331944a5ba27e0a21c8938c40-47"></a><span class="nf">cinvoke</span>  <span class="no">exit</span>
<a name="rest_code_4928b01331944a5ba27e0a21c8938c40-48"></a>
<a name="rest_code_4928b01331944a5ba27e0a21c8938c40-49"></a><span class="nf">segment</span> <span class="no">readable</span> <span class="no">writeable</span>
<a name="rest_code_4928b01331944a5ba27e0a21c8938c40-50"></a><span class="nf">pars</span>    <span class="no">db</span> <span class="err">'</span><span class="nv">%d%d</span><span class="err">'</span><span class="p">,</span><span class="mi">0</span>
<a name="rest_code_4928b01331944a5ba27e0a21c8938c40-51"></a><span class="nf">parspf</span>  <span class="no">db</span> <span class="err">'</span><span class="nv">%d</span><span class="err">'</span><span class="p">,</span><span class="mi">0xa</span><span class="p">,</span><span class="mi">0</span>
<a name="rest_code_4928b01331944a5ba27e0a21c8938c40-52"></a><span class="nf">n</span>       <span class="no">dd</span> <span class="mi">0</span>
<a name="rest_code_4928b01331944a5ba27e0a21c8938c40-53"></a><span class="nf">m</span>       <span class="no">dd</span> <span class="mi">0</span>
</pre></td>
</tr></table>
<p>The assembled code will perform the same way, but the executable produced is about 10 times smaller! With the assembly code, we will have more liberty to use architecture specific instructions. And, if we see that there are unnecessary register spills happening, we may modify the code to avoid it. (using "register" keyword and -O3 option in gcc makes good use of registers)</p>
<p>p.s.</p>
<ul>
<li>
<p class="first">By default, disassembly syntax is not intel. To change it, use</p>
<table class="codetable"><tr>
<td class="linenos"><div class="linenodiv"><pre><a href="posts/c-code-to-assembly-using-gcc-and-gdb/#rest_code_f92673bf65894718bd85f0916b9c100e-0">0</a></pre></div></td>
<td class="code"><pre class="code bash"><a name="rest_code_f92673bf65894718bd85f0916b9c100e-0"></a><span class="nb">set</span> disassembly-flavor intel
</pre></td>
</tr></table>
<p>You may consider placing it in <tt class="docutils literal"><span class="pre">$HOME/.gdbinit</span></tt> to use intel syntax everytime.</p>
</li>
<li>
<p class="first"><tt class="docutils literal"><span class="pre">-m32</span></tt> option in gcc is not required if 32 bit linux distro is used.</p>
</li>
<li>
<p class="first"><tt class="docutils literal"><span class="pre">-g</span></tt> option is helpful in debugging the executable. We can check instruction-wise disassembly and also deduce the operator  precedence. You'll never need another silly book on C. When in doubt, go to the root!</p>
</li>
</ul>
</div>
    </div>
    </article><article class="h-entry post-text"><header><h1 class="p-name entry-title"><a href="posts/average-number-of-switch-flips-required-to-turn-on-all-the-lights/" class="u-url">Average Number Of Switch Flips Required To Turn On All The Lights</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn">
                Gopinath
            </span></p>
            <p class="dateline"><a href="posts/average-number-of-switch-flips-required-to-turn-on-all-the-lights/" rel="bookmark"><time class="published dt-published" datetime="2014-01-18T10:51:51+05:30" title="2014-01-18 10:51">2014-01-18 10:51</time></a></p>
        </div>
    </header><div class="e-content entry-content">
    <div>
<p><em>Suppose there is an array of lights, initially all turned off, and during each step you randomly select a light and turn it on or off if it's in off or on state, respectively. On an average, how many steps are required to take it to all turned on state?</em></p>
<p>This can be solved using an absorbing Markov chain, or by using a probability tree diagram.</p>
<p>In the method using the absorbing Markov chain, the starting state is for all turned off.
It can move to the next state which is for one random light turned on. The probability of moving to that state is 1.</p>
<p>From state 1, it can go back to state 0 with a probability of <span class="math">\(\dfrac{1}{n}\)</span>, or to state 2 with probability of <span class="math">\(1-\dfrac{1}{n}\)</span>.</p>
<p>And so on, in the <span class="math">\((n-1)^{th}\)</span> state, it can go to the absorbing state n with a probability of frac{1}{n}.</p>
<p>E.g. For <span class="math">\(n=6\)</span>, the matrix looks like this:</p>
<div class="math">
\begin{equation*}
A=\left(\begin{array}{rrrrrrr}
0 &amp; 1 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\[10pt]
\dfrac{1}{6} &amp; 0 &amp; \dfrac{5}{6} &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\[10pt]
0 &amp; \dfrac{1}{3} &amp; 0 &amp; \dfrac{2}{3} &amp; 0 &amp; 0 &amp; 0 \\[10pt]
0 &amp; 0 &amp; \dfrac{1}{2} &amp; 0 &amp; \dfrac{1}{2} &amp; 0 &amp; 0 \\[10pt]
0 &amp; 0 &amp; 0 &amp; \dfrac{2}{3} &amp; 0 &amp; \dfrac{1}{3} &amp; 0 \\[10pt]
0 &amp; 0 &amp; 0 &amp; 0 &amp; \dfrac{5}{6} &amp; 0 &amp; \dfrac{1}{6} \\[10pt]
0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 1
\end{array}\right)
\end{equation*}
</div>
<p>Thus, the matrix Q is:</p>
<div class="math">
\begin{equation*}
Q=\left(\begin{array}{rrrrrr}
0 &amp; 1 &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\[10pt]
\dfrac{1}{6} &amp; 0 &amp; \dfrac{5}{6} &amp; 0 &amp; 0 &amp; 0 \\[10pt]
0 &amp; \dfrac{1}{3} &amp; 0 &amp; \dfrac{2}{3} &amp; 0 &amp; 0 \\[10pt]
0 &amp; 0 &amp; \dfrac{1}{2} &amp; 0 &amp; \dfrac{1}{2} &amp; 0 \\[10pt]
0 &amp; 0 &amp; 0 &amp; \dfrac{2}{3} &amp; 0 &amp; \dfrac{1}{3} \\[10pt]
0 &amp; 0 &amp; 0 &amp; 0 &amp; \dfrac{5}{6} &amp; 0
\end{array}\right)
\end{equation*}
</div>
<p>And the Expected number of steps is found from</p>
<div class="math">
\begin{equation*}
(I-Q)^{-1} = \left(\begin{array}{rrrrrr}
\dfrac{13}{5} &amp; \dfrac{48}{5} &amp; 21 &amp; 26 &amp; 18 &amp; 6 \\[10pt]
\dfrac{8}{5} &amp; \dfrac{48}{5} &amp; 21 &amp; 26 &amp; 18 &amp; 6 \\[10pt]
\dfrac{7}{5} &amp; \dfrac{42}{5} &amp; 21 &amp; 26 &amp; 18 &amp; 6 \\[10pt]
\dfrac{13}{10} &amp; \dfrac{39}{5} &amp; \dfrac{39}{2} &amp; 26 &amp; 18
&amp; 6 \\[10pt]
\dfrac{6}{5} &amp; \dfrac{36}{5} &amp; 18 &amp; 24 &amp; 18 &amp; 6 \\[10pt]
1 &amp; 6 &amp; 15 &amp; 20 &amp; 15 &amp; 6
\end{array}\right)
\end{equation*}
</div>
<p>The sum of first row gives the expected time it takes to move from the initial state to the absorbing state, which evaluates to <span class="math">\(\dfrac{416}{5} = 83.2\)</span> steps.</p>
<p>This markov chain can be used also to calculate the probability of being in a certain state after 'k' steps.</p>
<p>E.g. What is the probability of all 6 lights being turned on after random flipping of switches 8 times?</p>
<div class="math">
\begin{equation*}
A^8=\left(\begin{array}{rrrrrrr}
\dfrac{169}{4374} &amp; 0 &amp; \dfrac{1105}{2187} &amp; 0 &amp; \dfrac{815}{1944} &amp; 0 &amp; \dfrac{215}{5832} \\[10pt]
0 &amp; \dfrac{2717}{13122} &amp; 0 &amp; \dfrac{16175}{26244} &amp; 0 &amp; \dfrac{815}{5832} &amp; \dfrac{215}{5832} \\[10pt]
\dfrac{221}{6561} &amp; 0 &amp; \dfrac{12487}{26244} &amp; 0 &amp; \dfrac{931}{2187} &amp; 0 &amp; \dfrac{7}{108} \\[10pt]
0 &amp; \dfrac{3235}{17496} &amp; 0 &amp; \dfrac{10381}{17496} &amp; 0 &amp; \dfrac{5003}{34992} &amp; \dfrac{919}{11664} \\[10pt]
\dfrac{163}{5832} &amp; 0 &amp; \dfrac{931}{2187} &amp; 0 &amp; \dfrac{42613}{104976} &amp; 0 &amp; \dfrac{14741}{104976} \\[10pt]
0 &amp; \dfrac{815}{5832} &amp; 0 &amp; \dfrac{25015}{52488} &amp; 0 &amp; \dfrac{12595}{104976} &amp; \dfrac{9227}{34992} \\[10pt]
0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 1
\end{array}\right)
\end{equation*}
</div>
<p>Answer is <span class="math">\(A^8[0,6] = \dfrac{215}{5832}\)</span></p>
<p>We can construct the markov chain and calculate the expected value in Sagemath (a very promising free CAS) as follows:</p>
<table class="codetable"><tr>
<td class="linenos"><div class="linenodiv"><pre><a href="posts/average-number-of-switch-flips-required-to-turn-on-all-the-lights/#rest_code_2c11ca9c30f2424daa74e4402517686f-0">0</a>
<a href="posts/average-number-of-switch-flips-required-to-turn-on-all-the-lights/#rest_code_2c11ca9c30f2424daa74e4402517686f-1">1</a>
<a href="posts/average-number-of-switch-flips-required-to-turn-on-all-the-lights/#rest_code_2c11ca9c30f2424daa74e4402517686f-2">2</a>
<a href="posts/average-number-of-switch-flips-required-to-turn-on-all-the-lights/#rest_code_2c11ca9c30f2424daa74e4402517686f-3">3</a>
<a href="posts/average-number-of-switch-flips-required-to-turn-on-all-the-lights/#rest_code_2c11ca9c30f2424daa74e4402517686f-4">4</a>
<a href="posts/average-number-of-switch-flips-required-to-turn-on-all-the-lights/#rest_code_2c11ca9c30f2424daa74e4402517686f-5">5</a>
<a href="posts/average-number-of-switch-flips-required-to-turn-on-all-the-lights/#rest_code_2c11ca9c30f2424daa74e4402517686f-6">6</a>
<a href="posts/average-number-of-switch-flips-required-to-turn-on-all-the-lights/#rest_code_2c11ca9c30f2424daa74e4402517686f-7">7</a>
<a href="posts/average-number-of-switch-flips-required-to-turn-on-all-the-lights/#rest_code_2c11ca9c30f2424daa74e4402517686f-8">8</a></pre></div></td>
<td class="code"><pre class="code python"><a name="rest_code_2c11ca9c30f2424daa74e4402517686f-0"></a><span class="n">n</span><span class="o">=</span><span class="mi">6</span>
<a name="rest_code_2c11ca9c30f2424daa74e4402517686f-1"></a><span class="n">mx</span><span class="o">=</span><span class="p">[[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">)]</span>
<a name="rest_code_2c11ca9c30f2424daa74e4402517686f-2"></a><span class="n">mx</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="mi">1</span>
<a name="rest_code_2c11ca9c30f2424daa74e4402517686f-3"></a><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">n</span><span class="p">):</span>
<a name="rest_code_2c11ca9c30f2424daa74e4402517686f-4"></a>    <span class="n">mx</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="n">i</span><span class="o">/</span><span class="n">n</span>
<a name="rest_code_2c11ca9c30f2424daa74e4402517686f-5"></a>    <span class="n">mx</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="mi">1</span><span class="o">-</span><span class="n">i</span><span class="o">/</span><span class="n">n</span>
<a name="rest_code_2c11ca9c30f2424daa74e4402517686f-6"></a><span class="n">mx</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">n</span><span class="p">]</span><span class="o">=</span><span class="mi">1</span>
<a name="rest_code_2c11ca9c30f2424daa74e4402517686f-7"></a><span class="n">am</span><span class="o">=</span><span class="n">matrix</span><span class="p">(</span><span class="n">mx</span><span class="p">)</span>
<a name="rest_code_2c11ca9c30f2424daa74e4402517686f-8"></a><span class="k">print</span> <span class="nb">sum</span><span class="p">((</span><span class="n">identity_matrix</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">-</span><span class="n">am</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">n</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="n">n</span><span class="p">])</span><span class="o">.</span><span class="n">inverse</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">list</span><span class="p">())</span>
</pre></td>
</tr></table>
<p>If we want to know only the expected value, we can use the tree method:</p>
<div class="figure">
<img alt="../../images/flip1.png" src="images/flip1.png"><p class="caption">Probability tree to calculate expected value</p>
</div>
<div class="math">
\begin{equation*}
E_0=1\cdot(1+E_1)
\end{equation*}
</div>
<div class="math">
\begin{equation*}
E_1 = \dfrac{1}{n}\cdot(1+E_0)+\left(1-\dfrac{1}{n}\right)\cdot(1+E_2)
\end{equation*}
</div>
<div class="math">
\begin{equation*}
E_2=\dfrac{2}{n}\cdot(1+E_1)+\left(1-\dfrac{2}{n}\right)\cdot(1+E_3)
\end{equation*}
</div>
<div class="math">
\begin{equation*}
\vdots
\end{equation*}
</div>
<div class="math">
\begin{equation*}
E_{n-1}=\dfrac{n-1}{n}\cdot(1+E_{n-2})+\left(1-\dfrac{n-1}{n}\right)\cdot(1)
\end{equation*}
</div>
<p>From the above set of equations, we can derive the following algorithm to calculate the expected value in Sage:</p>
<table class="codetable"><tr>
<td class="linenos"><div class="linenodiv"><pre><a href="posts/average-number-of-switch-flips-required-to-turn-on-all-the-lights/#rest_code_068ed99fb44043808abbe43ccfcc6997-0">0</a>
<a href="posts/average-number-of-switch-flips-required-to-turn-on-all-the-lights/#rest_code_068ed99fb44043808abbe43ccfcc6997-1">1</a>
<a href="posts/average-number-of-switch-flips-required-to-turn-on-all-the-lights/#rest_code_068ed99fb44043808abbe43ccfcc6997-2">2</a>
<a href="posts/average-number-of-switch-flips-required-to-turn-on-all-the-lights/#rest_code_068ed99fb44043808abbe43ccfcc6997-3">3</a>
<a href="posts/average-number-of-switch-flips-required-to-turn-on-all-the-lights/#rest_code_068ed99fb44043808abbe43ccfcc6997-4">4</a>
<a href="posts/average-number-of-switch-flips-required-to-turn-on-all-the-lights/#rest_code_068ed99fb44043808abbe43ccfcc6997-5">5</a>
<a href="posts/average-number-of-switch-flips-required-to-turn-on-all-the-lights/#rest_code_068ed99fb44043808abbe43ccfcc6997-6">6</a>
<a href="posts/average-number-of-switch-flips-required-to-turn-on-all-the-lights/#rest_code_068ed99fb44043808abbe43ccfcc6997-7">7</a>
<a href="posts/average-number-of-switch-flips-required-to-turn-on-all-the-lights/#rest_code_068ed99fb44043808abbe43ccfcc6997-8">8</a></pre></div></td>
<td class="code"><pre class="code python"><a name="rest_code_068ed99fb44043808abbe43ccfcc6997-0"></a><span class="n">ax</span><span class="o">=</span><span class="mi">1</span>
<a name="rest_code_068ed99fb44043808abbe43ccfcc6997-1"></a><span class="n">n</span><span class="o">=</span><span class="mi">6</span>
<a name="rest_code_068ed99fb44043808abbe43ccfcc6997-2"></a><span class="n">summ</span><span class="o">=</span><span class="mi">0</span>
<a name="rest_code_068ed99fb44043808abbe43ccfcc6997-3"></a><span class="n">i</span><span class="o">=</span><span class="mi">0</span>
<a name="rest_code_068ed99fb44043808abbe43ccfcc6997-4"></a><span class="k">while</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">n</span><span class="p">:</span>
<a name="rest_code_068ed99fb44043808abbe43ccfcc6997-5"></a>    <span class="n">ax</span><span class="o">=</span><span class="p">(</span><span class="n">ax</span><span class="o">*</span><span class="n">i</span><span class="o">+</span><span class="n">x</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="n">i</span><span class="p">)</span>
<a name="rest_code_068ed99fb44043808abbe43ccfcc6997-6"></a>    <span class="n">summ</span> <span class="o">+=</span> <span class="n">ax</span>
<a name="rest_code_068ed99fb44043808abbe43ccfcc6997-7"></a>    <span class="n">i</span><span class="o">+=</span><span class="mi">1</span>
<a name="rest_code_068ed99fb44043808abbe43ccfcc6997-8"></a><span class="k">print</span> <span class="n">summ</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>
</pre></td>
</tr></table>
<p>As we see, the n is taken to be 6, and the answer returned is 416/5. The variable name is chosen as 'summ', since sum is a function's name. And, ax indicates a function of x.</p>
<p>For higher values of n, we get e.g.</p>
<p><span class="math">\(n=32:\)</span></p>
<div class="math">
\begin{equation*}
\dfrac{20053487665674803216384}{4512611027925}\approx 4443876846.81
\end{equation*}
</div>
<p><span class="math">\(n=64:\)</span></p>
<div class="math">
\begin{equation*}
\dfrac{346357890987659686224886668704722715345420288}{18472920064106597929865025} \approx 18749493300771803147.7216833338
\end{equation*}
</div>
</div>
    </div>
    </article><article class="h-entry post-text"><header><h1 class="p-name entry-title"><a href="posts/configuring-broadband-connection-using-pppoeconf/" class="u-url">Configuring Broadband Connection using pppoeconf</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn">
                Gopinath
            </span></p>
            <p class="dateline"><a href="posts/configuring-broadband-connection-using-pppoeconf/" rel="bookmark"><time class="published dt-published" datetime="2012-11-14T22:51:48+05:30" title="2012-11-14 22:51">2012-11-14 22:51</time></a></p>
        </div>
    </header><div class="e-content entry-content">
    <div>
<p>It all started when the lightning struck and disrupted the internet service. Previously, the settings were stored in the router itself, but after the incident it was no longer connecting to the ppp server.</p>
<p>I called the ISP, and the router's configuration was changed by the support guy and since he's familiar only with windoze, I had to reboot it to windows xp (which I no longer use, only linux based OS now). Now, in order to connect to the internet, the username/password needs to be given in the dial-up prompt for the broadband connection (pppoe). But, for some weird reason, DNS was working, but no ping reply from any sites!</p>
<p>So I decided to try in linux mint, and thought of using pppoeconf.</p>
<p>It's straight-forward, for my ISP's connection the default settings worked. The only information which I needed to change was the username/password</p>
<p>To my surprise, ping replies were okay, but the DNS look up was not working now. After tinkering around with the files in <tt class="docutils literal">/etc/ppp</tt> and reading some man pages related to ppp, I discovered an info referring to <tt class="docutils literal">/etc/resolv.conf</tt> file. But, there was no such file in <tt class="docutils literal">/etc</tt> by default.</p>
<p>So, I copied the <tt class="docutils literal">/etc/ppp/resolv.conf</tt> to <tt class="docutils literal">/etc</tt></p>
<p>Surprise again, it was still not working. Then I tried <tt class="docutils literal">strace nslookup google.com</tt></p>
<p>Somewhere near the end of the output, I found <tt class="docutils literal"><span class="pre">open("/etc/resolv.conf",</span> O_RDONLY) = <span class="pre">-1</span> EACCES (Permission denied)</tt>. So, <tt class="docutils literal">sudo chmod 0644 /etc/resolv.conf</tt>, and rebooted the system.</p>
<p>Everything worked fine after that.</p>
<p>Update: Actually, we need not worry about configuring from the terminal at all. With network manager already there, we just need to go to "network connections"-&gt;"DSL"  in the menu, and add our connection id/passwd.</p>
</div>
    </div>
    </article>
</div>

        <nav class="postindexpager"><ul class="pager">
<li class="previous">
                <a href="index-2.html" rel="prev">Newer posts</a>
            </li>
        </ul></nav><script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"> </script><script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"] ],
        displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
        processEscapes: true
    },
    displayAlign: 'left', // Change this to 'center' to center equations.
    "HTML-CSS": {
        styles: {'.MathJax_Display': {"margin": 0}}
    }
});
</script>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2016         <a href="mailto:gopinath68@gmail.com">Gopinath</a> - Powered by         <a href="https://getnikola.com" rel="nofollow">Nikola</a>         
            
        </footer>
</div>
</div>


            <script src="assets/js/all-nocdn.js"></script><script>$('a.image-reference:not(.islink) img:not(.islink)').parent().colorbox({rel:"gal",maxWidth:"100%",maxHeight:"100%",scalePhotos:true});</script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates -->
</body>
</html>
