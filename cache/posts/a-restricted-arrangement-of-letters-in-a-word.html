<p><em>Find number of ways to arrange letters in word &quot;benzine&quot; such that no two same letters are adjacent to each other</em></p>
<p>This is quite a tough nut to crack. But, there are multiple ways to solve this: by summation, generating function, a recurrence and by integration; summation being the most efficient one.</p>
<div class="section" id="by-summation">
<h1>1 By summation</h1>
<p>We'll start with a generalized formula for 5 distinct objects, each with <span class="math">\(n_i\)</span> repetitions. The summation formula can be written as:</p>
<div class="math">
\begin{equation*}
\displaystyle N(n_1,n_2,n_3,n_4,n_5)=\sum_{x_{1}=1}^{n_{1}}\sum_{x_{2}=1}^{n_{2}}\sum_{x_{3}=1}^{n_{3}}\sum_{x_{4}=1}^{n_{4}}\sum_{x_{5}=1}^{n_{5}}\, (-1)^{n_{1}+n_{2}+n_{3}+n_{4}+n_{5}-x_{1}-x_{2}-x_{3}-x_{4}-x_{5}}\, \dfrac{(x_{1}+x_{2}+x_{3}+x_{4}+x_{5})!}{x_1!x_2!x_3!x_4!x_5!} \cdot \dbinom{n_{1}-1}{x_{1}-1}\,\dbinom{n_{2}-1}{x_{2}-1}\,\dbinom{n_{3}-1}{x_{3}-1}\,\dbinom{n_{4}-1}{x_{4}-1}\,\dbinom{n_{5}-1}{x_{5}-1}
\end{equation*}
</div>
<p>and for our problem, we need to find <span class="math">\(N(2,2,1,1,1)\)</span>. Putting that in Sage:</p>
<table class="codetable"><tr><td class="linenos"><div class="linenodiv"><pre><a href="#rest_code_cc881f4b7ecd4d8c84b62408f2e5f950-0">0</a>
<a href="#rest_code_cc881f4b7ecd4d8c84b62408f2e5f950-1">1</a>
<a href="#rest_code_cc881f4b7ecd4d8c84b62408f2e5f950-2">2</a></pre></div></td><td class="code"><pre class="code python"><a name="rest_code_cc881f4b7ecd4d8c84b62408f2e5f950-0"></a><span class="n">var</span><span class="p">(</span><span class="s1">&#39;x1 x2 x3 x4 x5&#39;</span><span class="p">)</span>
<a name="rest_code_cc881f4b7ecd4d8c84b62408f2e5f950-1"></a><span class="n">n1</span><span class="p">,</span><span class="n">n2</span><span class="p">,</span><span class="n">n3</span><span class="p">,</span><span class="n">n4</span><span class="p">,</span><span class="n">n5</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span>
<a name="rest_code_cc881f4b7ecd4d8c84b62408f2e5f950-2"></a><span class="nb">sum</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="nb">sum</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">^</span><span class="p">(</span><span class="n">n1</span><span class="o">+</span><span class="n">n2</span><span class="o">+</span><span class="n">n3</span><span class="o">+</span><span class="n">n4</span><span class="o">+</span><span class="n">n5</span><span class="o">-</span><span class="n">x1</span><span class="o">-</span><span class="n">x2</span><span class="o">-</span><span class="n">x3</span><span class="o">-</span><span class="n">x4</span><span class="o">-</span><span class="n">x5</span><span class="p">)</span><span class="o">*</span><span class="n">factorial</span><span class="p">(</span><span class="n">x1</span><span class="o">+</span><span class="n">x2</span><span class="o">+</span><span class="n">x3</span><span class="o">+</span><span class="n">x4</span><span class="o">+</span><span class="n">x5</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">factorial</span><span class="p">(</span><span class="n">x1</span><span class="p">)</span><span class="o">*</span><span class="n">factorial</span><span class="p">(</span><span class="n">x2</span><span class="p">)</span><span class="o">*</span><span class="n">factorial</span><span class="p">(</span><span class="n">x3</span><span class="p">)</span><span class="o">*</span><span class="n">factorial</span><span class="p">(</span><span class="n">x4</span><span class="p">)</span><span class="o">*</span><span class="n">factorial</span><span class="p">(</span><span class="n">x5</span><span class="p">))</span><span class="o">*</span><span class="n">binomial</span><span class="p">(</span><span class="n">SR</span><span class="p">(</span><span class="n">n1</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">x1</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">binomial</span><span class="p">(</span><span class="n">SR</span><span class="p">(</span><span class="n">n2</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">x2</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">binomial</span><span class="p">(</span><span class="n">SR</span><span class="p">(</span><span class="n">n3</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">x3</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">binomial</span><span class="p">(</span><span class="n">SR</span><span class="p">(</span><span class="n">n4</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">x4</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">binomial</span><span class="p">(</span><span class="n">SR</span><span class="p">(</span><span class="n">n5</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">x5</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span><span class="n">x1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">n1</span><span class="p">),</span><span class="n">x2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">n2</span><span class="p">),</span><span class="n">x3</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">n3</span><span class="p">),</span><span class="n">x4</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">n4</span><span class="p">),</span><span class="n">x5</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">n5</span><span class="p">)</span>
</pre></td></tr></table><p><span class="math">\(=660\)</span></p>
</div>
<div class="section" id="generating-function">
<h1>2 Generating function</h1>
<p>This is actually just a part of the generating function (which I think can be derived from the recurrence relation)</p>
<div class="math">
\begin{equation*}
\displaystyle G_n(v,w,x,y,z)=\left(\begin{array}{rrrrr} v &amp; w &amp; x &amp; y &amp; z \end{array}\right)\cdot \left(\begin{array}{rrrrr} 0 &amp; w &amp; x &amp; y &amp; z \\ v &amp; 0 &amp; x &amp; y &amp; z \\ v &amp; w &amp; 0 &amp; y &amp; z \\ v &amp; w &amp; x &amp; 0 &amp; z \\ v &amp; w &amp; x &amp; y &amp; 0 \end{array}\right)^{n-1}\cdot \left(\begin{array}{r} 1 \\ 1 \\ 1 \\ 1 \\ 1 \end{array}\right)
\end{equation*}
</div>
<p>The coefficient of <span class="math">\(v^2 w^2 x y z\)</span> is the answer (evidently 660).</p>
<p>In Sage:</p>
<table class="codetable"><tr><td class="linenos"><div class="linenodiv"><pre><a href="#rest_code_0224099779fb42ba809bb8a965ec64a8-0">0</a>
<a href="#rest_code_0224099779fb42ba809bb8a965ec64a8-1">1</a>
<a href="#rest_code_0224099779fb42ba809bb8a965ec64a8-2">2</a>
<a href="#rest_code_0224099779fb42ba809bb8a965ec64a8-3">3</a>
<a href="#rest_code_0224099779fb42ba809bb8a965ec64a8-4">4</a>
<a href="#rest_code_0224099779fb42ba809bb8a965ec64a8-5">5</a></pre></div></td><td class="code"><pre class="code python"><a name="rest_code_0224099779fb42ba809bb8a965ec64a8-0"></a><span class="n">var</span><span class="p">(</span><span class="s1">&#39;v w x y z&#39;</span><span class="p">)</span>
<a name="rest_code_0224099779fb42ba809bb8a965ec64a8-1"></a><span class="n">a</span> <span class="o">=</span> <span class="n">matrix</span><span class="p">([</span><span class="n">v</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">])</span>
<a name="rest_code_0224099779fb42ba809bb8a965ec64a8-2"></a><span class="n">A</span> <span class="o">=</span> <span class="n">matrix</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">],</span> <span class="p">[</span><span class="n">v</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">],</span> <span class="p">[</span><span class="n">v</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">],</span> <span class="p">[</span><span class="n">v</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">z</span><span class="p">],</span> <span class="p">[</span><span class="n">v</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="mi">0</span><span class="p">]])</span>
<a name="rest_code_0224099779fb42ba809bb8a965ec64a8-3"></a><span class="n">ones</span> <span class="o">=</span> <span class="n">ones_matrix</span><span class="p">(</span><span class="n">QQ</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<a name="rest_code_0224099779fb42ba809bb8a965ec64a8-4"></a><span class="n">fxt</span> <span class="o">=</span> <span class="n">expand</span><span class="p">(</span><span class="n">a</span><span class="o">*</span><span class="p">(</span><span class="n">A</span><span class="o">^</span><span class="mi">6</span><span class="p">)</span><span class="o">*</span><span class="n">ones</span><span class="p">)[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
<a name="rest_code_0224099779fb42ba809bb8a965ec64a8-5"></a><span class="n">fxt</span><span class="o">.</span><span class="n">coefficient</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">coefficient</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">coefficient</span><span class="p">(</span><span class="n">z</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">coefficient</span><span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">coefficient</span><span class="p">(</span><span class="n">w</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
</pre></td></tr></table></div>
<div class="section" id="by-recurrence">
<h1>3 By recurrence</h1>
<div class="math">
\begin{equation*}
\displaystyle f_{p,q,r,s,t}=\left\{\begin{matrix} 0 &amp; \text{if any of }p,q,r,s,t&lt;0\\ 1 &amp; \text{if any one of }p,q,r,s,t = 1 \text{ and others } 0\\ 2 &amp; \text{if any two of }p,q,r,s,t = 1 \text{ and others } 0\\ 6 &amp; \text{if any three of }p,q,r,s,t = 1 \text{ and the other's } 0\\ 24 &amp; \text{if any four of }p,q,r,s,t = 1 \text{ and the other } 0\\ 120 &amp; \text{if all of }p,q,r,s,t = 1 \\ A &amp; \text{otherwise} \end{matrix}\right.
\end{equation*}
</div>
<p>where</p>
<div class="math">
\begin{align*}
\displaystyle A=f_{p-1,q-1,r,s,t} + f_{p-1,q,r-1,s,t} + f_{p-1,q,r,s-1,t} + f_{p-1,q,r,s,t-1} + f_{p,q-1,r-1,s,t}+\\ f_{p,q-1,r,s-1,t} + f_{p,q-1,r,s,t-1} + f_{p,q,r-1,s-1,t} + f_{p,q,r-1,s,t-1} + f_{p,q,r,s-1,t-1}+\\ 2\cdot (f_{p-1,q-1,r-1,s,t} + f_{p-1,q-1,r,s-1,t} + f_{p-1,q-1,r,s,t-1} + f_{p-1,q,r-1,s-1,t}+ f_{p-1,q,r-1,s,t-1}+\\ f_{p-1,q,r,s-1,t-1} + f_{p,q-1,r-1,s-1,t} + f_{p,q-1,r-1,s,t-1} + f_{p,q-1,r,s-1,t-1} + f_{p,q,r-1,s-1,t-1})+\\ 3\cdot (f_{p-1,q-1,r-1,s-1,t} + f_{p-1,q-1,r-1,s,t-1} + f_{p-1,q-1,r,s-1,t-1} + f_{p-1,q,r-1,s-1,t-1} + f_{p,q-1,r-1,s-1,t-1})+4\cdot f_{p-1,q-1,r-1,s-1,t-1}
\end{align*}
</div>
<p>In Sage (python will also do), to print out the number of arrangements and its probability of occuring:</p>
<table class="codetable"><tr><td class="linenos"><div class="linenodiv"><pre><a href="#rest_code_a8a1912047044055b5c19f1ed4886e67-0"> 0</a>
<a href="#rest_code_a8a1912047044055b5c19f1ed4886e67-1"> 1</a>
<a href="#rest_code_a8a1912047044055b5c19f1ed4886e67-2"> 2</a>
<a href="#rest_code_a8a1912047044055b5c19f1ed4886e67-3"> 3</a>
<a href="#rest_code_a8a1912047044055b5c19f1ed4886e67-4"> 4</a>
<a href="#rest_code_a8a1912047044055b5c19f1ed4886e67-5"> 5</a>
<a href="#rest_code_a8a1912047044055b5c19f1ed4886e67-6"> 6</a>
<a href="#rest_code_a8a1912047044055b5c19f1ed4886e67-7"> 7</a>
<a href="#rest_code_a8a1912047044055b5c19f1ed4886e67-8"> 8</a>
<a href="#rest_code_a8a1912047044055b5c19f1ed4886e67-9"> 9</a>
<a href="#rest_code_a8a1912047044055b5c19f1ed4886e67-10">10</a>
<a href="#rest_code_a8a1912047044055b5c19f1ed4886e67-11">11</a>
<a href="#rest_code_a8a1912047044055b5c19f1ed4886e67-12">12</a>
<a href="#rest_code_a8a1912047044055b5c19f1ed4886e67-13">13</a>
<a href="#rest_code_a8a1912047044055b5c19f1ed4886e67-14">14</a>
<a href="#rest_code_a8a1912047044055b5c19f1ed4886e67-15">15</a>
<a href="#rest_code_a8a1912047044055b5c19f1ed4886e67-16">16</a>
<a href="#rest_code_a8a1912047044055b5c19f1ed4886e67-17">17</a></pre></div></td><td class="code"><pre class="code python"><a name="rest_code_a8a1912047044055b5c19f1ed4886e67-0"></a><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<a name="rest_code_a8a1912047044055b5c19f1ed4886e67-1"></a><span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">q</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="n">t</span><span class="p">)</span> <span class="p">:</span>
<a name="rest_code_a8a1912047044055b5c19f1ed4886e67-2"></a>    <span class="k">if</span> <span class="nb">sum</span><span class="p">([</span><span class="mi">0</span><span class="p">]</span><span class="o">&gt;</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">p</span><span class="p">,</span><span class="n">q</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="n">t</span><span class="p">]))</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
<a name="rest_code_a8a1912047044055b5c19f1ed4886e67-3"></a>        <span class="k">return</span> <span class="mi">0</span>
<a name="rest_code_a8a1912047044055b5c19f1ed4886e67-4"></a>    <span class="k">if</span> <span class="nb">sum</span><span class="p">([</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">p</span><span class="p">,</span><span class="n">q</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="n">t</span><span class="p">]))</span><span class="o">==</span><span class="mi">5</span><span class="p">:</span>
<a name="rest_code_a8a1912047044055b5c19f1ed4886e67-5"></a>        <span class="k">return</span> <span class="mi">120</span>
<a name="rest_code_a8a1912047044055b5c19f1ed4886e67-6"></a>    <span class="k">if</span> <span class="nb">sum</span><span class="p">([</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">p</span><span class="p">,</span><span class="n">q</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="n">t</span><span class="p">]))</span><span class="o">==</span><span class="mi">4</span> <span class="ow">and</span> <span class="nb">sum</span><span class="p">([</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">p</span><span class="p">,</span><span class="n">q</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="n">t</span><span class="p">]))</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
<a name="rest_code_a8a1912047044055b5c19f1ed4886e67-7"></a>        <span class="k">return</span> <span class="mi">24</span>
<a name="rest_code_a8a1912047044055b5c19f1ed4886e67-8"></a>    <span class="k">if</span> <span class="nb">sum</span><span class="p">([</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">p</span><span class="p">,</span><span class="n">q</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="n">t</span><span class="p">]))</span><span class="o">==</span><span class="mi">3</span> <span class="ow">and</span> <span class="nb">sum</span><span class="p">([</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">p</span><span class="p">,</span><span class="n">q</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="n">t</span><span class="p">]))</span><span class="o">==</span><span class="mi">2</span><span class="p">:</span>
<a name="rest_code_a8a1912047044055b5c19f1ed4886e67-9"></a>        <span class="k">return</span> <span class="mi">6</span>
<a name="rest_code_a8a1912047044055b5c19f1ed4886e67-10"></a>    <span class="k">if</span> <span class="nb">sum</span><span class="p">([</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">p</span><span class="p">,</span><span class="n">q</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="n">t</span><span class="p">]))</span><span class="o">==</span><span class="mi">2</span> <span class="ow">and</span> <span class="nb">sum</span><span class="p">([</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">p</span><span class="p">,</span><span class="n">q</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="n">t</span><span class="p">]))</span><span class="o">==</span><span class="mi">3</span><span class="p">:</span>
<a name="rest_code_a8a1912047044055b5c19f1ed4886e67-11"></a>        <span class="k">return</span> <span class="mi">2</span>
<a name="rest_code_a8a1912047044055b5c19f1ed4886e67-12"></a>    <span class="k">if</span> <span class="nb">sum</span><span class="p">([</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">p</span><span class="p">,</span><span class="n">q</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="n">t</span><span class="p">]))</span><span class="o">==</span><span class="mi">1</span> <span class="ow">and</span> <span class="nb">sum</span><span class="p">([</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">p</span><span class="p">,</span><span class="n">q</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="n">t</span><span class="p">]))</span><span class="o">==</span><span class="mi">4</span><span class="p">:</span>
<a name="rest_code_a8a1912047044055b5c19f1ed4886e67-13"></a>        <span class="k">return</span> <span class="mi">1</span>
<a name="rest_code_a8a1912047044055b5c19f1ed4886e67-14"></a>    <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="n">p</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">q</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="n">t</span><span class="p">)</span><span class="o">+</span> <span class="n">f</span><span class="p">(</span><span class="n">p</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">q</span><span class="p">,</span><span class="n">r</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="n">t</span><span class="p">)</span><span class="o">+</span> <span class="n">f</span><span class="p">(</span><span class="n">p</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">q</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="n">s</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">t</span><span class="p">)</span><span class="o">+</span> <span class="n">f</span><span class="p">(</span><span class="n">p</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">q</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="n">t</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span> <span class="n">f</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">q</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">r</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="n">t</span><span class="p">)</span><span class="o">+</span> <span class="n">f</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">q</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="n">s</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">t</span><span class="p">)</span><span class="o">+</span> <span class="n">f</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">q</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="n">t</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span> <span class="n">f</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">q</span><span class="p">,</span><span class="n">r</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">s</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">t</span><span class="p">)</span><span class="o">+</span> <span class="n">f</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">q</span><span class="p">,</span><span class="n">r</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="n">t</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span> <span class="n">f</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">q</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="n">s</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">t</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="n">p</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">q</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">r</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="n">t</span><span class="p">)</span><span class="o">+</span> <span class="n">f</span><span class="p">(</span><span class="n">p</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">q</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="n">s</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">t</span><span class="p">)</span><span class="o">+</span> <span class="n">f</span><span class="p">(</span><span class="n">p</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">q</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="n">t</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span> <span class="n">f</span><span class="p">(</span><span class="n">p</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">q</span><span class="p">,</span><span class="n">r</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">s</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">t</span><span class="p">)</span><span class="o">+</span> <span class="n">f</span><span class="p">(</span><span class="n">p</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">q</span><span class="p">,</span><span class="n">r</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="n">t</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span> <span class="n">f</span><span class="p">(</span><span class="n">p</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">q</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="n">s</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">t</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span> <span class="n">f</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">q</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">r</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">s</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">t</span><span class="p">)</span><span class="o">+</span> <span class="n">f</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">q</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">r</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="n">t</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span> <span class="n">f</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">q</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="n">s</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">t</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span> <span class="n">f</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">q</span><span class="p">,</span><span class="n">r</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">s</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">t</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span> <span class="o">+</span><span class="mi">3</span><span class="o">*</span><span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="n">p</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">q</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">r</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">s</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">t</span><span class="p">)</span><span class="o">+</span> <span class="n">f</span><span class="p">(</span><span class="n">p</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">q</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">r</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="n">t</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span> <span class="n">f</span><span class="p">(</span><span class="n">p</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">q</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="n">s</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">t</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span> <span class="n">f</span><span class="p">(</span><span class="n">p</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">q</span><span class="p">,</span><span class="n">r</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">s</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">t</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span> <span class="n">f</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">q</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">r</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">s</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">t</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="o">+</span><span class="mi">4</span><span class="o">*</span><span class="n">f</span><span class="p">(</span><span class="n">p</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">q</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">r</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">s</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">t</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a name="rest_code_a8a1912047044055b5c19f1ed4886e67-15"></a><span class="n">a1</span><span class="p">,</span><span class="n">a2</span><span class="p">,</span><span class="n">a3</span><span class="p">,</span><span class="n">a4</span><span class="p">,</span><span class="n">a5</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span>
<a name="rest_code_a8a1912047044055b5c19f1ed4886e67-16"></a><span class="n">tot</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">a1</span><span class="p">,</span><span class="n">a2</span><span class="p">,</span><span class="n">a3</span><span class="p">,</span><span class="n">a4</span><span class="p">,</span><span class="n">a5</span><span class="p">)</span>
<a name="rest_code_a8a1912047044055b5c19f1ed4886e67-17"></a><span class="k">print</span> <span class="n">tot</span><span class="p">,</span> <span class="n">tot</span><span class="o">/</span><span class="p">(</span><span class="n">factorial</span><span class="p">(</span><span class="n">a1</span><span class="o">+</span><span class="n">a2</span><span class="o">+</span><span class="n">a3</span><span class="o">+</span><span class="n">a4</span><span class="o">+</span><span class="n">a5</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">factorial</span><span class="p">(</span><span class="n">a1</span><span class="p">)</span><span class="o">*</span><span class="n">factorial</span><span class="p">(</span><span class="n">a2</span><span class="p">)</span><span class="o">*</span><span class="n">factorial</span><span class="p">(</span><span class="n">a3</span><span class="p">)</span><span class="o">*</span><span class="n">factorial</span><span class="p">(</span><span class="n">a4</span><span class="p">)</span><span class="o">*</span><span class="n">factorial</span><span class="p">(</span><span class="n">a5</span><span class="p">)))</span>
</pre></td></tr></table><p>NumPy is used here, since it allows array to be manipulated just like in an array programming language like J. The condition checking is made much shorter.</p>
<p>The recurrence is too slow if used for higher values. This can be sped up by caching the computed values, e.g. by dynamic programming.</p>
<p>We may back up our analytical results with a simulation (always a good thing to do, when possible)</p>
<table class="codetable"><tr><td class="linenos"><div class="linenodiv"><pre><a href="#rest_code_2039f39679374acc911ed8ecefa8eebb-0">0</a>
<a href="#rest_code_2039f39679374acc911ed8ecefa8eebb-1">1</a>
<a href="#rest_code_2039f39679374acc911ed8ecefa8eebb-2">2</a></pre></div></td><td class="code"><pre class="code text"><a name="rest_code_2039f39679374acc911ed8ecefa8eebb-0"></a>a=.1 1 2 2 3 4 5
<a name="rest_code_2039f39679374acc911ed8ecefa8eebb-1"></a>sim=: 3 : &#39;0=+/0=2-/\(7?7){a&#39;
<a name="rest_code_2039f39679374acc911ed8ecefa8eebb-2"></a>(+/%#)(sim&quot;0)1000000#0
</pre></td></tr></table><p>about <span class="math">\(0.523729\)</span>, which is close to the actual result <span class="math">\(0.523809523809524\)</span>.</p>
</div>
<div class="section" id="using-integrals">
<h1>4 Using Integrals</h1>
<p>One more way is to make use of integrals, which actually conveys the summation in a compact representation.</p>
<div class="math">
\begin{equation*}
\displaystyle N(\{n_i\})=\int_0^\infty \prod_i q_{n_i}(x)\, e^{-x} \, dx
\end{equation*}
</div>
<p>where</p>
<div class="math">
\begin{equation*}
\displaystyle q_{n_i}(x) = \sum_{i=1}^{n_i} \frac{(-1)^{i-n_i}}{i!} {n_i-1 \choose i-1}x^i \text{ for }n_i\geq 1
\end{equation*}
</div>
<p><span class="math">\(n_i\)</span> is the number of repetitions of each character in the set.</p>
<p>For our example, the list of <span class="math">\(n_i\)</span> can be written as [2,2,1,1,1]</p>
<p>Hence, in Sage:</p>
<table class="codetable"><tr><td class="linenos"><div class="linenodiv"><pre><a href="#rest_code_a44a88d2b55046eba0183827d8dc451f-0">0</a>
<a href="#rest_code_a44a88d2b55046eba0183827d8dc451f-1">1</a>
<a href="#rest_code_a44a88d2b55046eba0183827d8dc451f-2">2</a>
<a href="#rest_code_a44a88d2b55046eba0183827d8dc451f-3">3</a></pre></div></td><td class="code"><pre class="code python"><a name="rest_code_a44a88d2b55046eba0183827d8dc451f-0"></a><span class="n">var</span><span class="p">(</span><span class="s1">&#39;i&#39;</span><span class="p">)</span>
<a name="rest_code_a44a88d2b55046eba0183827d8dc451f-1"></a><span class="k">def</span> <span class="nf">q</span><span class="p">(</span><span class="n">n</span><span class="p">):</span> <span class="k">return</span> <span class="nb">sum</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">^</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">n</span><span class="p">)</span><span class="o">/</span><span class="n">factorial</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="n">binomial</span><span class="p">(</span><span class="n">SR</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">SR</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">x</span><span class="o">^</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
<a name="rest_code_a44a88d2b55046eba0183827d8dc451f-2"></a><span class="n">lst</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
<a name="rest_code_a44a88d2b55046eba0183827d8dc451f-3"></a><span class="n">integrate</span><span class="p">(</span><span class="n">prod</span><span class="p">([</span><span class="n">q</span><span class="p">(</span><span class="n">l</span><span class="p">)</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">lst</span><span class="p">])</span><span class="o">*</span><span class="n">e</span><span class="o">^-</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">oo</span><span class="p">)</span>
</pre></td></tr></table><p>which displays our expected answer.</p>
<p>References:</p>
<p><a class="reference external" href="https://brilliant.org/discussions/thread/permutation-problemneed-some-experts/">1. Brilliant.org discussion</a></p>
<p><a class="reference external" href="https://math.stackexchange.com/questions/76213/how-many-arrangements-of-a-2b-3c-4d-5e-have-no-identical-consecutive-lett">2. Stackexchange question</a></p>
<p><a class="reference external" href="https://math.stackexchange.com/questions/129451/find-the-number-of-arrangements-of-k-mbox-1s-k-mbox-2s-cdots">3. Another stackexchange question</a></p>
</div>
